<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Ujian Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press+Start+2P', cursive;
            background: linear-gradient(to bottom, #4facfe, #00f2fe); /* Blue gradient */
            color: #FFFFFF;
            text-shadow: 2px 2px #000000;
            overflow: hidden;
        }
        .pixel-border {
            border: 4px solid #000;
            box-shadow: 
                inset -4px -4px 0px 0px rgba(0,0,0,0.4),
                4px 4px 0px 0px #000000;
        }
        .quiz-card {
            background-color: #2a7de1; /* Darker Blue */
            border-color: #0c3b74;
        }
        .option-btn {
            background-color: #fca444; /* Orange-Yellow */
            border: 4px solid #000;
            box-shadow: inset -4px -4px 0px 0px #a45c0c;
            transition: all 0.1s ease-in-out;
        }
        .option-btn:hover {
            background-color: #ffb454;
        }
        .option-btn:active {
            box-shadow: inset 4px 4px 0px 0px #a45c0c;
            transform: translateY(2px);
        }
        .option-btn.correct {
            background-color: #50d850; /* Green */
            box-shadow: inset -4px -4px 0px 0px #008c00;
        }
        .option-btn.incorrect {
            background-color: #d83838; /* Red */
            box-shadow: inset -4px -4px 0px 0px #8c0000;
            opacity: 0.7;
        }
        .disabled {
            pointer-events: none;
        }
        .screen {
             animation: screenFadeIn 0.5s ease-in-out forwards;
        }
        .question-transition-out {
            animation: questionFadeOut 0.3s ease-in-out forwards;
        }
        .question-transition-in {
             animation: questionFadeIn 0.3s ease-in-out forwards;
        }
        @keyframes screenFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes questionFadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(20px); }
        }
        @keyframes questionFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .action-btn {
            background-color: #50d850;
            box-shadow: inset -6px -6px 0px 0px #008c00;
        }
        .action-btn:hover {
             background-color: #60e060;
        }
        .action-btn:active {
            box-shadow: inset 6px 6px 0px 0px #008c00;
        }
        .surrender-btn {
            background-color: #d83838;
            box-shadow: inset -4px -4px 0px 0px #8c0000;
            border: 2px solid #000;
        }
        .surrender-btn:hover {
            background-color: #e04848;
        }
        .surrender-btn:active {
            box-shadow: inset 4px 4px 0px 0px #8c0000;
        }
        #name-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
            text-shadow: 1px 1px #000000;
        }
        #name-input {
            text-shadow: 2px 2px #000000;
        }
    </style>
</head>
<body class="text-white">

    <div id="app" class="container mx-auto p-4 min-h-screen flex flex-col justify-center items-center">
        
        <div id="start-screen" class="screen text-center p-8 rounded-lg max-w-lg w-full">
            <h1 class="text-4xl mb-4 leading-tight">Tes Pengetahuan Medis</h1>
            <p class="text-sm text-white mb-8">Edisi Darah & Onkologi</p>
            <input type="text" id="name-input" placeholder="Tulis Namamu di Sini..." class="w-full p-4 mb-6 text-center bg-black/20 rounded-lg text-lg pixel-border focus:outline-none">
            <p class="mb-8 text-sm leading-relaxed">Kamu punya waktu 1 jam untuk buktikan kemampuanmu. Jangan mengecewakan!</p>
            <button id="start-btn" class="w-full action-btn text-white font-bold py-4 px-8 rounded-lg text-xl pixel-border">
                Mulai Ujian!
            </button>
        </div>

        <div id="quiz-screen" class="hidden w-full max-w-4xl">
            <header class="mb-4 p-4 rounded-lg pixel-border bg-[#1c5aab]">
                <div class="flex justify-between items-center text-md flex-wrap gap-4">
                    <p>Soal <span id="current-question-num">1</span>/<span id="total-questions">77</span></p>
                    <p class="font-bold text-yellow-300">Skor: <span id="score">0</span></p>
                    <p class="font-bold">Waktu: <span id="quiz-timer">60:00</span></p>
                    <button id="surrender-btn" class="surrender-btn text-white font-bold py-1 px-3 rounded-lg text-xs">Menyerah</button>
                </div>
                <div class="w-full bg-black/50 rounded-full h-4 mt-2 pixel-border p-1">
                    <div id="progress-bar" class="bg-yellow-400 h-full rounded-sm" style="width: 0%; transition: width 0.3s ease;"></div>
                </div>
            </header>
            
            <div id="quiz-card" class="p-6 sm:p-8 rounded-lg quiz-card pixel-border">
                <p id="question-text" class="text-lg sm:text-xl leading-normal mb-6 min-h-[100px] flex items-center justify-center text-center"></p>
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                </div>
                 <div class="mt-6 text-right">
                    <button id="manual-next-btn" class="hidden action-btn text-white font-bold py-2 px-6 rounded-lg text-sm pixel-border">Lanjut</button>
                </div>
            </div>
        </div>

        <div id="results-screen" class="hidden screen text-center p-8 rounded-lg max-w-lg w-full pixel-border bg-[#1c5aab]">
            <h2 class="text-3xl font-bold mb-4">Ujian Selesai!</h2>
            <p class="text-lg text-white mb-2">Skor Akhir Kamu:</p>
            <p id="final-score" class="text-7xl font-bold my-4"></p>
            <p id="final-feedback" class="text-sm mb-8 leading-relaxed"></p>
            <button id="retry-btn" class="w-full action-btn text-white font-bold py-4 px-8 rounded-lg text-xl pixel-border">
                Ulangi Ujian
            </button>
        </div>

        <div id="loading-overlay" class="hidden fixed inset-0 bg-black bg-opacity-75 flex flex-col justify-center items-center z-50">
            <p id="loading-text" class="text-2xl text-white">Memuat Suara...</p>
        </div>

    </div>
    <audio id="tts-audio" style="display: none;"></audio>

    <script>
        const quizData = [
            { question: "Obat manakah yang digunakan untuk mencegah pembentukan trombus dalam pembuluh darah?", options: ["Aspirin", "Warfarin", "Heparin", "Asam tranexamat", "Urokinase"], answer: "Warfarin" },
            { question: "Eritrosit yang berumur 120 hari akan difagositosis oleh makrofag di lien karena dianggap zat asing, hal ini disebabkan oleh...", options: ["Penurunan stabilitas membran sel akibat kehilangan asam sialic", "Penurunan stabilitas membran sel akibat kehilangan lipid", "Penurunan stabilitas membran sel akibat penurunan Ca", "a dan b benar", "a, b, c benar"], answer: "a dan b benar" },
            { question: "Gold standard untuk pemeriksaan leptospirosis adalah...", options: ["ELISA IgM", "ELISA IgG", "MAT (Microscopic Agglutination Test)", "Leptospira IgM rapid test", "Leptospira IgG rapid test"], answer: "MAT (Microscopic Agglutination Test)" },
            { question: "Anak laki-laki 3 tahun dengan Hb, Ht, Eri menurun, MCV 68fL, MCH 22 pg, dan RDW 25%, kemungkinan diagnosisnya adalah...", options: ["Thalassemia", "Inflamasi", "Infeksi kronis", "Defisiensi besi", "Anemia aplastik"], answer: "Defisiensi besi" },
            { question: "Pada fase inisiasi koagulasi, ikatan antara Tissue Factor (TF) dan Faktor VII (FVII) secara langsung akan menyebabkan aktivasi...", options: ["Faktor V", "Faktor X", "Endothelium", "Platelet", "Faktor IX"], answer: "Faktor X" },
            { question: "Mutasi gen yang paling sering ditemukan pada kasus Polisitemia Vera adalah...", options: ["JAK2 exon 12", "BCR/ABL", "C-MPL", "CRL AML", "JAK2 V617F"], answer: "JAK2 V617F" },
            { question: "Ketika pembuluh darah terluka, mekanisme hemostasis vaskuler yang pertama kali terjadi adalah...", options: ["Endotel menghasilkan histamin", "Adhesi trombosit", "Aktivasi trombosit", "Vasokonstriksi pembuluh darah", "Terbentuk sumbatan trombosit"], answer: "Vasokonstriksi pembuluh darah" },
            { question: "Anemia akibat peningkatan destruksi eritrosit (hemolitik) yang disebabkan oleh kelainan intrinsik herediter adalah...", options: ["Defisiensi G6PD", "Autoantibodi", "Mikroorganisme", "Reaksi transfusi", "Sekuestrasi limpa"], answer: "Defisiensi G6PD" },
            { question: "Komposisi terbanyak dari plasma darah adalah...", options: ["Protein plasma", "Air", "Eritrosit", "Leukosit", "Trombosit"], answer: "Air" },
            { question: "Jika ditemukan infeksi cacing dalam tinja, seri leukosit mana yang kemungkinan besar akan meningkat pada pemeriksaan darah?", options: ["Basofil", "Eosinofil", "Limfosit", "Monosit", "Neutrofil"], answer: "Eosinofil" },
            { question: "Pada proses eritropoiesis, hemoglobin (Hb) mulai dibentuk pada stadium...", options: ["Polikromatik eritoblas", "Basofilik eritoblas", "Proeritroblas", "Retikulosit", "Ortokromatik eritoblas"], answer: "Polikromatik eritoblas" },
            { question: "Bagaimana glutation tereduksi (GSH) berperan dalam metabolisme eritrosit?", options: ["Mengubah Hb menjadi oxyhemoglobin", "Mengubah methemoglobin menjadi Hb", "Membentuk NADPH untuk siklus glutation", "Menguraikan superoksida menjadi H2O2", "Menguraikan H2O2 menjadi air"], answer: "Menguraikan H2O2 menjadi air" },
            { question: "Pada organ limpa (lien), bagian yang terutama terlibat dalam fungsi imunologis adalah...", options: ["Pulpa putih (white pulp)", "Pulpa merah (red pulp)", "PALS (Periarteriolar lymphoid sheath)", "Sinusoid", "Billroth's cord"], answer: "Pulpa putih (white pulp)" },
            { question: "Untuk pemeriksaan hitung retikulosit pada kasus anemia hemolitik, pewarnaan supravital yang digunakan adalah...", options: ["Giemsa", "Brilliant Cresyl Blue", "Wright", "Ziehl-Neelsen", "Gram"], answer: "Brilliant Cresyl Blue" },
            { question: "Perubahan integritas membran eritrosit yang menyebabkannya difagositosis dapat disebabkan oleh...", options: ["Hilangnya asam sialic", "Hilangnya lipid", "Peningkatan Ca intraseluler", "A dan B benar", "A, B, dan C benar"], answer: "A, B, dan C benar" },
            { question: "Hidrokel skrotum, limfedema, dan elephantiasis pada filariasis merupakan manifestasi klinis yang terjadi pada fase...", options: ["Stadium inkubasi", "Stadium akut", "Stadium kronik", "Stadium asimtomatik mikrofilariatik", "Stadium asimtomatik amikrofilariatik"], answer: "Stadium kronik" },
            { question: "Sel darah yang fungsi utamanya mengangkut oksigen adalah...", options: ["Plasma", "Trombosit", "Eritrosit", "Leukosit", "Limfosit"], answer: "Eritrosit" },
            { question: "Wuchereria bancrofti memiliki periodisitas mikrofilaria di darah tepi yang bersifat...", options: ["Nokturnal", "Diurnal", "Subperiodik nokturnal", "Subperiodik diurnal", "Non-periodik"], answer: "Nokturnal" },
            { question: "Senyawa yang menjaga integritas struktural dan fleksibilitas membran eritrosit adalah...", options: ["Glikogen dan kolagen", "Asam amino esensial", "Hanya protein spektrin", "Protein dan lipid", "Hanya kolesterol"], answer: "Protein dan lipid" },
            { question: "Kompleks protrombinase yang berperan penting dalam fase propagasi koagulasi terdiri dari...", options: ["Faktor Va dan Faktor VIIIa", "Faktor Va dan Faktor Xa", "Faktor IXa dan Faktor VIIa", "Faktor IXa dan Faktor Xa", "Faktor Va, VIIIa, dan Xa"], answer: "Faktor Va dan Faktor Xa" },
            { question: "Pasien didiagnosis pneumonia akibat bakteri. Interpretasi pemeriksaan darah lengkap yang paling mungkin ditemukan adalah...", options: ["Neutrofilia", "Eosinofilia", "Leukopenia", "Limfositosis", "Anemia mikrositik"], answer: "Neutrofilia" },
            { question: "Sel stem hematopoiesis (HSC) pada orang dewasa diproduksi terutama di...", options: ["Endosteal niche di epifisis dan metafisis tulang panjang", "Diafisis tulang panjang", "Limpa dan hati", "Kelenjar timus", "Sumsum tulang kuning"], answer: "Endosteal niche di epifisis dan metafisis tulang panjang" },
            { question: "Fungsi utama jalur pentosa fosfat (pentose phosphate pathway) pada eritrosit adalah...", options: ["Menghasilkan ATP", "Menghasilkan asam laktat", "Menghasilkan NADPH dan ribosa-5-fosfat", "Menghasilkan glukosa", "Menghasilkan glikogen"], answer: "Menghasilkan NADPH dan ribosa-5-fosfat" },
            { question: "Bentuk vitamin K sintetis yang memiliki risiko efek samping lebih tinggi adalah...", options: ["Menadion (K3)", "Filokuinon (K1)", "Fitonadion (K1)", "Menakuinon (K2)", "Naftokuinon"], answer: "Menadion (K3)" },
            { question: "Kadar hemoglobin minimal yang disyaratkan bagi seorang pendonor darah adalah...", options: ["10 g/dl", "11.5 g/dl", "14 g/dl", "12,5 g/dl", "12 g/dl"], answer: "12,5 g/dl" },
            { question: "Anemia pernisiosa disebabkan oleh defisiensi penyerapan...", options: ["Zat besi", "Asam folat", "Vitamin B12 (kobalamin)", "Vitamin C", "Piridoksin (B6)"], answer: "Vitamin B12 (kobalamin)" },
            { question: "Pernyataan yang benar mengenai monosit adalah...", options: ["Tidak ditemukan pool monosit di sumsum tulang", "Monosit berada di sirkulasi darah selama beberapa bulan", "Bentuk monosit tidak berubah saat masuk ke jaringan", "A dan B benar", "Hanya hidup di pembuluh darah"], answer: "Tidak ditemukan pool monosit di sumsum tulang" },
            { question: "Peran utama vitamin E (α-tokoferol) pada membran eritrosit adalah...", options: ["Mengaktifkan enzim glikolisis", "Membantu penyerapan zat besi", "Memperbanyak produksi eritrosit", "Mencegah peroksidasi lipid sebagai antioksidan", "Sebagai kofaktor sintesis hemoglobin"], answer: "Mencegah peroksidasi lipid sebagai antioksidan" },
            { question: "Aliran limfe dari kuadran lateral atas payudara sebagian besar akan menuju ke...", options: ["Lnn. subklavia", "Lnn. interpektoralis (Rotter's)", "Lnn. aksilaris anterior (pektoralis)", "Lnn. parasternales", "Duktus torasikus langsung"], answer: "Lnn. aksilaris anterior (pektoralis)" },
            { question: "Bagaimana pengaruh 2,3-BPG (bisfosfogliserat) terhadap afinitas hemoglobin terhadap oksigen?", options: ["Tidak ada pengaruh", "Meningkatkan produksi ATP", "Mengurangi afinitas Hb terhadap O2", "Meningkatkan afinitas Hb terhadap O2", "Mengikat karbondioksida"], answer: "Mengurangi afinitas Hb terhadap O2" },
            { question: "Pada sindrom syok dengue, patogenesis utama yang menyebabkan kebocoran plasma adalah...", options: ["Peningkatan permeabilitas vaskular", "Aktivasi komplemen yang merusak jaringan", "Aktivasi sel T memori dan produksi sitokin proinflamasi", "Trombositopenia berat", "Semua benar"], answer: "Peningkatan permeabilitas vaskular" },
            { question: "Pada uji silang serasi (crossmatch) mayor sebelum transfusi, yang direaksikan adalah...", options: ["Serum pasien dan sel darah merah donor", "Serum donor dan sel darah merah pasien", "Serum pasien dan serum donor", "Sel darah merah pasien dan sel darah merah donor", "Plasma pasien dan plasma donor"], answer: "Serum pasien dan sel darah merah donor" },
            { question: "Regulasi utama pembentukan eritropoietin (EPO) oleh ginjal dirangsang oleh...", options: ["Peningkatan tekanan CO2", "Peningkatan tekanan O2", "Penurunan tekanan O2 (hipoksia)", "Penurunan tekanan CO2", "Peningkatan pH darah"], answer: "Penurunan tekanan O2 (hipoksia)" },
            { question: "Infeksi aliran darah yang terjadi tanpa adanya sumber infeksi lain di organ atau jaringan lain disebut...", options: ["Infeksi aliran darah primer", "Infeksi aliran darah sekunder", "Infeksi ekstravaskular", "Infeksi intravaskular", "Bakteremia transien"], answer: "Infeksi aliran darah primer" },
            { question: "Trombosit (platelet) berasal dari fragmentasi sitoplasma sel besar di sumsum tulang yang disebut...", options: ["Trombopoiesis", "CFU-Meg", "Megakariosit", "Mieloblas", "Limfoblas"], answer: "Megakariosit" },
            { question: "Pasien gagal ginjal kronik yang menjalani hemodialisis rutin sering mengalami anemia karena produksi hormon ini menurun...", options: ["Eritropoietin", "Trombopoietin", "Timopoietin", "Interleukin-6", "G-CSF"], answer: "Eritropoietin" },
            { question: "Manifestasi klinis pada sepsis yang terjadi akibat aktivasi berlebihan sistem komplemen adalah...", options: ["Disfungsi endotel vaskular", "Peningkatan permeabilitas kapiler", "Trombosis mikrovaskular", "Peradangan dan kerusakan jaringan", "Hanya peningkatan sitokin"], answer: "Peradangan dan kerusakan jaringan" },
            { question: "Perubahan genetik khas yang menjadi dasar kejadian leukemia mielositik kronik (CML) adalah...", options: ["Trisomi 21", "Delesi 5q", "Translokasi t(15;17)", "Translokasi t(9;22) atau Kromosom Philadelphia", "Inversi 16"], answer: "Translokasi t(9;22) atau Kromosom Philadelphia" },
            { question: "Kumpulan nodul limfatik yang ditemukan di dinding ileum (usus halus) disebut...", options: ["Sel dendritik", "Peyer's patch", "BALT", "Limfonodus mesenterika", "Tonsil"], answer: "Peyer's patch" },
            { question: "Duktus limfatikus dekstra menerima aliran limfe dari beberapa trunkus, salah satunya adalah...", options: ["Trunkus bronkomediastinal dekstra", "Trunkus intestinal", "Trunkus lumbalis sinistra", "Trunkus jugularis sinistra", "Seluruh tubuh bagian bawah"], answer: "Trunkus bronkomediastinal dekstra" },
            { question: "Seorang pasien tertusuk jarum kecil. Mekanisme hemostasis yang paling cepat dan utama untuk mengatasinya adalah...", options: ["Hemostasis primer", "Hemostasis sekunder", "Hemostasis tersier", "Fibrinolisis", "Respon inflamasi"], answer: "Hemostasis primer" },
            { question: "Demam Katayama, suatu manifestasi klinis akut pada schistosomiasis, disebabkan oleh...", options: ["Reaksi imun terhadap telur cacing yang baru diletakkan", "Migrasi cacing dewasa di pembuluh darah", "Penetrasi serkaria di kulit", "Efek toksin dari mikrofilaria", "Infeksi bakteri sekunder"], answer: "Reaksi imun terhadap telur cacing yang baru diletakkan" },
            { question: "Poin penting yang harus diperhatikan saat pengambilan darah untuk kultur adalah...", options: ["Boleh didinginkan sebelum inkubasi", "Disinfeksi dengan alkohol 70% saja sudah cukup", "Darah harus diantarkan ke lab dalam 2 jam pada suhu kamar", "Volume 5 ml cukup untuk orang dewasa", "Pengambilan setelah pemberian antibiotik lebih baik"], answer: "Darah harus diantarkan ke lab dalam 2 jam pada suhu kamar" },
            { question: "Antikoagulan yang digunakan untuk pemeriksaan koagulasi darah seperti PT dan aPTT adalah...", options: ["EDTA", "Heparin", "Natrium sitrat", "Natrium fluorida", "Hayem"], answer: "Natrium sitrat" },
            { question: "Aliran limfatik dari regio areola dan papilla mammae sebagian besar menuju ke...", options: ["Lnn. pektoralis (anterior)", "Lnn. parasternal", "Lnn. apikal dan supraklavikula", "Lnn. subklavia", "Lnn. interpektoralis"], answer: "Lnn. pektoralis (anterior)" },
            { question: "Obat antiinflamasi nonsteroid (NSAID) seperti aspirin memiliki efek antiplatelet dengan menghambat...", options: ["Aktivitas tromboksan A2", "Faktor Xa", "Trombin", "Vitamin K", "Fibrinogen"], answer: "Aktivitas tromboksan A2" },
            { question: "Ciri khas dari granula pada sitoplasma basofil adalah...", options: ["Halus, sedikit, tidak menutupi inti", "Halus, banyak, menutupi inti", "Kasar, sedikit, tidak menutupi inti", "Kasar, banyak, menutupi inti", "Tidak memiliki granula"], answer: "Kasar, banyak, menutupi inti" },
            { question: "Spesies Plasmodium yang memiliki fase dorman di hati (hipnozoit) dan dapat menyebabkan relaps adalah...", options: ["P. falciparum dan P. vivax", "P. vivax dan P. malariae", "P. vivax dan P. ovale", "P. falciparum dan P. malariae", "P. falciparum dan P. knowlesi"], answer: "P. vivax dan P. ovale" },
            { question: "Pasien pneumonia karena bakteri akan menunjukkan peningkatan leukosit jenis...", options: ["Eosinofil", "Basofil", "Neutrofil", "Limfosit", "Monosit"], answer: "Neutrofil" },
            { question: "Seorang perempuan mengalami fraktur tulang akibat kecelakaan dan membutuhkan transfusi untuk mengganti volume darah yang hilang. Komponen darah yang paling tepat diberikan adalah...", options: ["Whole Blood (WB)", "Packed Red Cells (PRC)", "Washed Red Cells (WRC)", "Fresh Frozen Plasma (FFP)", "Thrombocyte Concentrate (TC)"], answer: "Packed Red Cells (PRC)" },
            { question: "Untuk pemeriksaan anemia hemolitik autoimun (AIHA), tabung antikoagulan yang paling sesuai adalah...", options: ["EDTA (ungu)", "Heparin (hijau)", "Natrium sitrat (biru)", "Natrium fluorida (abu-abu)", "Tanpa antikoagulan (merah)"], answer: "EDTA (ungu)" },
            { question: "Bagaimana kadar retikulosit pada pasien dengan anemia hemolitik aktif?", options: ["Menurun (di bawah 0.5%)", "Normal (0.5-2.5%)", "Meningkat (di atas 2.5%)", "Tidak terdeteksi", "Sangat bervariasi"], answer: "Meningkat (di atas 2.5%)" },
            { question: "Pemeriksaan imunohistokimia untuk mengidentifikasi limfoma maligna sel B matur menggunakan penanda...", options: ["CD3", "CD20", "CD56", "Mieloperoksidase (MPO)", "CD34"], answer: "CD20" },
            { question: "Tonsila palatina dilapisi oleh epitel jenis...", options: ["Epitel silindris bersilia", "Epitel pipih berlapis tidak berkeratin", "Epitel kubus selapis", "Epitel transisional", "Epitel kolumnar pseudostratified"], answer: "Epitel pipih berlapis tidak berkeratin" },
            { question: "Pada diferensiasi sel B, naive B cell yang berada di mantle zone akan berkembang menjadi...", options: ["Naive B cell di follicular zone", "Memory B cell di marginal zone", "Sel plasma", "Immunoblas", "Sentrosit"], answer: "Memory B cell di marginal zone" },
            { question: "Naive B cell yang masuk ke follicular zone akan berdiferensiasi menjadi...", options: ["Naive B cell di mantle zone", "Memory B cell", "Sel plasma", "Sentroblas dan sentrosit", "Limfosit T"], answer: "Sentroblas dan sentrosit" },
            { question: "Pemeriksaan pre-transfusi untuk mendeteksi antibodi yang melapisi sel darah merah pasien pada kasus AIHA adalah...", options: ["Golongan darah ABO/Rh", "Uji silang serasi", "Direct Coombs Test (DAT)", "Indirect Coombs Test (IAT)", "Screening antibodi"], answer: "Direct Coombs Test (DAT)" },
            { question: "Saat janin berusia 9 bulan, organ utama yang berperan dalam hematopoiesis (pembentukan darah) adalah...", options: ["Sumsum tulang", "Limpa, hati, dan kelenjar limfe", "Yolk sac", "Hati saja", "Limpa saja"], answer: "Sumsum tulang" },
            { question: "Berikut ini pernyataan yang benar mengenai duktus torasikus adalah...", options: ["Bermuara ke pertemuan vena subklavia dekstra dan jugularis interna dekstra", "Nama lainnya adalah duktus limfatikus dekstra", "Menerima limfe dari seluruh tubuh", "Bermuara ke pertemuan vena subklavia sinistra dan jugularis interna sinistra", "Ukurannya lebih kecil dari duktus limfatikus dekstra"], answer: "Bermuara ke pertemuan vena subklavia sinistra dan jugularis interna sinistra" },
            { question: "Organ limfatik primer, tempat pematangan limfosit, terdiri dari...", options: ["Limpa dan tonsil", "Sumsum tulang dan timus", "Peyer's patch dan apendiks", "Limfonodus dan limpa", "Hanya sumsum tulang"], answer: "Sumsum tulang dan timus" },
            { question: "Keganasan sel plasma yang disebut Multipel Myeloma berasal dari diferensiasi...", options: ["Naive B cell follicular zone", "Memory B cell marginal zone", "Sentrosit dan sentroblas", "Immunoblas", "Limfosit pre-B"], answer: "Memory B cell marginal zone" },
            { question: "Pada struktur limfonodus, limfosit B terutama ditemukan di bagian...", options: ["Sinus subkapsular", "Zona interfolikular", "Korteks dalam (parakorteks)", "Medula", "Folikel limfoid (korteks luar)"], answer: "Folikel limfoid (korteks luar)" },
            { question: "Peningkatan jumlah eosinofil dalam darah (eosinofilia) sering dikaitkan dengan infeksi...", options: ["Virus", "Bakteri gram-negatif", "Jamur", "Parasit cacing", "Bakteri intraseluler"], answer: "Parasit cacing" },
            { question: "Saraf yang memberikan inervasi sensorik utama ke tonsila palatina adalah...", options: ["N. palatinus mayor et minor", "N. glosofaringeus (CN IX)", "N. fasialis (CN VII)", "A & B benar", "A, B, dan C benar"], answer: "A & B benar" },
            { question: "Hairy Cell Leukemia adalah keganasan yang berasal dari...", options: ["Naive B cell", "Memory B cell", "Sel plasma", "Sentrosit setelah keluar dari folikel", "Limfosit T"], answer: "Sentrosit setelah keluar dari folikel" },
            { question: "Manfaat utama dari bentuk cakram bikonkaf pada eritrosit adalah...", options: ["Mempercepat aliran darah", "Meningkatkan fleksibilitas sel", "Memperluas rasio permukaan terhadap volume untuk pertukaran gas", "Memungkinkan sel membawa lebih banyak hemoglobin", "Mencegah lisis sel"], answer: "Memperluas rasio permukaan terhadap volume untuk pertukaran gas" },
            { question: "Tenase complex, yang berperan mengubah Faktor X menjadi Xa, tersusun atas...", options: ["Faktor Xa dan Va", "Faktor IXa dan VIIIa", "Faktor XIIa dan XIa", "Faktor VIIa dan Tissue Factor", "Trombin dan Fibrinogen"], answer: "Faktor IXa dan VIIIa" },
            { question: "Pada infeksi sekunder Dengue, respon imun yang lebih berat (ADE) terjadi karena...", options: ["Limfosit T memori memproduksi lebih banyak sitokin", "Permeabilitas vaskular meningkat drastis", "Sistem komplemen aktif berlebihan", "Antibodi dari infeksi pertama membentuk kompleks dengan virus baru", "Virus menjadi lebih virulen"], answer: "Antibodi dari infeksi pertama membentuk kompleks dengan virus baru" },
            { question: "Mekanisme kerja utama aspirin sebagai antitrombosit adalah...", options: ["Menghambat sintesis Tromboksan A2 melalui inhibisi COX", "Menjadi antagonis reseptor ADP", "Menghambat glikoprotein IIb/IIIa", "Mengaktivasi antitrombin III", "Menghambat faktor Xa"], answer: "Menghambat sintesis Tromboksan A2 melalui inhibisi COX" },
            { question: "Produksi hemoglobin dalam eritropoiesis dimulai pada stadium...", options: ["Proeritroblas", "Eritroblas basofilik", "Eritroblas polikromatofilik", "Eritroblas ortokromatik", "Retikulosit"], answer: "Eritroblas polikromatofilik" },
            { question: "Hospes perantara untuk cacing Schistosoma japonicum adalah...", options: ["Siput Oncomelania hupensis", "Manusia", "Nyamuk Anopheles", "Siput Biomphalaria", "Babi"], answer: "Siput Oncomelania hupensis" },
            { question: "Grup limfonodus servikal profunda terletak di sepanjang...", options: ["M. sternocleidomastoideus", "V. jugularis eksterna", "N. vagus", "A. karotis komunis", "Dasar mulut"], answer: "M. sternocleidomastoideus" },
            { question: "Arteri gastrika brevis yang menuju fundus gaster merupakan cabang dari a. splenica dan berjalan di dalam ligamen...", options: ["Splenocolica", "Splenophrenica", "Splenorenalis", "Gastrosplenica", "Phrenicocolica"], answer: "Gastrosplenica" }
        ];

        // Elements
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');
        const startBtn = document.getElementById('start-btn');
        const retryBtn = document.getElementById('retry-btn');
        const surrenderBtn = document.getElementById('surrender-btn');
        const nameInput = document.getElementById('name-input');
        const ttsAudio = document.getElementById('tts-audio');
        const loadingOverlay = document.getElementById('loading-overlay');
        const currentQNumEl = document.getElementById('current-question-num');
        const totalQEl = document.getElementById('total-questions');
        const scoreEl = document.getElementById('score');
        const progressBar = document.getElementById('progress-bar');
        const quizTimerEl = document.getElementById('quiz-timer');
        const quizCard = document.getElementById('quiz-card');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const manualNextBtn = document.getElementById('manual-next-btn');
        const finalScoreEl = document.getElementById('final-score');
        const finalFeedbackEl = document.getElementById('final-feedback');
        
        const TTS_API_KEY = "2bca63c883a0455cbdba6a251782cb9f";

        let currentQuestionIndex = 0;
        let score = 0;
        let shuffledQuestions = [];
        let quizTimerInterval;
        let totalTime;
        let autoNextTimeout;
        let userName = '';

        function generateAndPlayAudio(text) {
            loadingOverlay.classList.remove('hidden');

            const params = new URLSearchParams({
                key: TTS_API_KEY,
                src: text,
                hl: 'id-id',
                v: 'Dini', 
                r: '0',
                c: 'MP3',
                f: '44khz_16bit_stereo',
                b64: 'false'
            });

            const ttsUrl = `https://api.voicerss.org/?${params.toString()}`;
            
            ttsAudio.src = ttsUrl;
            ttsAudio.play().catch(e => {
                console.error("Audio playback failed:", e);
                loadingOverlay.classList.add('hidden');
            });
            
            const onAudioEnd = () => {
                loadingOverlay.classList.add('hidden');
                ttsAudio.removeEventListener('ended', onAudioEnd);
                ttsAudio.removeEventListener('error', onAudioEnd);
            };

            ttsAudio.addEventListener('ended', onAudioEnd);
            ttsAudio.addEventListener('error', onAudioEnd);
        }

        function startGame() {
            userName = nameInput.value.trim() || 'Tanpa Nama';
            
            startScreen.classList.add('hidden');
            
            const greetingText = `Selamat datang, ${userName}! Mari kita lihat seberapa jauh pengetahuanmu. Jangan sampai otakmu sekecil eritrosit ya!`;
            generateAndPlayAudio(greetingText);

            resultsScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');

            currentQuestionIndex = 0;
            score = 0;
            shuffledQuestions = [...quizData].sort(() => Math.random() - 0.5);
            totalQEl.textContent = shuffledQuestions.length;
            totalTime = 3600;
            
            startQuizTimer();
            showQuestion();
            updateScore();
        }

        function startQuizTimer() {
            quizTimerEl.textContent = "60:00";
            if(quizTimerInterval) clearInterval(quizTimerInterval);

            quizTimerInterval = setInterval(() => {
                totalTime--;
                const minutes = Math.floor(totalTime / 60).toString().padStart(2, '0');
                const seconds = (totalTime % 60).toString().padStart(2, '0');
                quizTimerEl.textContent = `${minutes}:${seconds}`;

                if (totalTime <= 0) {
                    clearInterval(quizTimerInterval);
                    showResults(false);
                }
            }, 1000);
        }

        function showQuestion() {
            resetState();
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            
            quizCard.classList.add('question-transition-in');
            currentQNumEl.textContent = currentQuestionIndex + 1;
            questionTextEl.textContent = currentQuestion.question;
            progressBar.style.width = `${((currentQuestionIndex + 1) / shuffledQuestions.length) * 100}%`;

            const optionSymbols = ['🩸', '🔬', '🧬', '💊', '🦠'];
            
            currentQuestion.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.classList.add('option-btn', 'p-4', 'rounded-lg', 'text-left', 'w-full', 'text-sm', 'md:text-base');
                button.innerHTML = `<span class="inline-block w-6 text-center mr-2">${optionSymbols[index % 5]}</span><span>${option}</span>`;
                button.dataset.answer = option;
                optionsContainer.appendChild(button);
                button.addEventListener('click', selectAnswer);
            });
        }
        
        function resetState(){
            clearTimeout(autoNextTimeout);
            manualNextBtn.classList.add('hidden');
            quizCard.classList.remove('question-transition-in');
            while(optionsContainer.firstChild){
                optionsContainer.removeChild(optionsContainer.firstChild);
            }
        }
        
        function selectAnswer(e) {
            const selectedBtn = e.currentTarget;
            showFeedback(selectedBtn);
        }
        
        function showFeedback(selectedBtn) {
            const correctAnswer = shuffledQuestions[currentQuestionIndex].answer;
            const isCorrect = selectedBtn && selectedBtn.dataset.answer === correctAnswer;

            if (isCorrect) {
                score += 10;
                selectedBtn.classList.add('correct');
            } else if (selectedBtn) {
                selectedBtn.classList.add('incorrect');
            }
            
            Array.from(optionsContainer.children).forEach(button => {
                if (button.dataset.answer === correctAnswer) {
                    button.classList.add('correct');
                }
                button.classList.add('disabled');
            });
            
            updateScore();
            manualNextBtn.classList.remove('hidden');
            autoNextTimeout = setTimeout(showNextQuestion, 2000);
        }

        function handleManualNext() {
            clearTimeout(autoNextTimeout);
            showNextQuestion();
        }

        function showNextQuestion() {
            currentQuestionIndex++;
            quizCard.classList.add('question-transition-out');
            
            setTimeout(() => {
                 if (currentQuestionIndex < shuffledQuestions.length) {
                    quizCard.classList.remove('question-transition-out');
                    showQuestion();
                } else {
                    showResults(false);
                }
            }, 300);
        }
        
        function updateScore() {
            scoreEl.textContent = score;
        }

        function showResults(surrendered = false) {
            clearInterval(quizTimerInterval);
            quizScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');

            const correctAnswers = score / 10;
            const totalQuestions = shuffledQuestions.length;
            const scorePercentage = totalQuestions > 0 ? (correctAnswers / totalQuestions) * 100 : 0;
            
            finalScoreEl.textContent = `${score}`;
            
            let feedbackText, ttsText;
            if (surrendered) {
                feedbackText = `Mentalmu setipis membran sel, ${userName}! Cepat kembali belajar!`;
                ttsText = `Menyerah itu pilihan para pecundang, ${userName}. Lain kali coba lebih keras!`;
            } else {
                feedbackText = `Kamu menjawab ${correctAnswers} dari ${totalQuestions} soal dengan benar! (${scorePercentage.toFixed(1)}%)`;
                ttsText = `Luar biasa, ${userName}! Hasilmu menunjukkan kerja keras. Terus asah pengetahuanmu, perjalananmu masih panjang!`;
            }
            finalFeedbackEl.textContent = feedbackText;
            generateAndPlayAudio(ttsText);
        }

        startBtn.addEventListener('click', startGame);
        retryBtn.addEventListener('click', () => {
             resultsScreen.classList.add('hidden');
             startScreen.classList.remove('hidden');
        });
        manualNextBtn.addEventListener('click', handleManualNext);
        surrenderBtn.addEventListener('click', () => showResults(true));

    </script>
</body>
</html>
