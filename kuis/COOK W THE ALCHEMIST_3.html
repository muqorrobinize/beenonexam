<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE ALCHEMIST: CH.03 ASCENSION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        void: '#050505',
                        surface: '#0a0a0a',
                        border: '#27272a',
                        accent: '#10b981', 
                        accentdim: '#064e3b',
                        mist: '#a1a1aa',
                        text: '#e4e4e7',
                        gold: '#fbbf24',
                        danger: '#ef4444'
                    },
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    typography: (theme) => ({
                        DEFAULT: {
                            css: {
                                color: theme('colors.mist'),
                                h1: { color: theme('colors.text') },
                                h2: { color: theme('colors.text') },
                                h3: { color: theme('colors.text') },
                                strong: { color: theme('colors.accent') },
                                blockquote: { 
                                    borderLeftColor: theme('colors.gold'), 
                                    color: theme('colors.text'),
                                    backgroundColor: 'rgba(251, 191, 36, 0.05)',
                                    padding: '1rem'
                                },
                                code: { color: theme('colors.accent') },
                            },
                        },
                    }),
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #050505; color: #e4e4e7; }
        .glass-header { background: rgba(5, 5, 5, 0.9); backdrop-filter: blur(16px); border-bottom: 1px solid rgba(39, 39, 42, 0.5); }
        .code-scroll::-webkit-scrollbar { height: 6px; width: 6px; }
        .code-scroll::-webkit-scrollbar-track { background: #0a0a0a; }
        .code-scroll::-webkit-scrollbar-thumb { background: #27272a; rounded: 3px; }
        .input-focus:focus { outline: none; border-color: #10b981; box-shadow: 0 0 0 1px #10b981; }
        
        .prompt-box {
            position: relative;
            background: #0a0a0a;
            border: 1px solid #27272a;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: #d4d4d4;
        }
        .prompt-box::before {
            content: "PROMPT TEMPLATE";
            position: absolute;
            top: -10px;
            left: 10px;
            background: #050505;
            padding: 0 5px;
            font-size: 0.6rem;
            color: #10b981;
            border: 1px solid #27272a;
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col font-sans selection:bg-accent selection:text-black overflow-x-hidden">

    <!-- Navbar -->
    <nav class="fixed top-0 w-full z-50 glass-header">
        <div class="max-w-3xl mx-auto px-6 py-5 flex justify-between items-center">
            <div class="font-bold tracking-tight text-lg text-accent flex items-center gap-3">
                <span class="text-xl border border-accent px-2 py-0.5 rounded-sm font-serif italic text-white bg-accentdim/20">Ta</span>
                <span class="text-sm tracking-widest text-mist">THE ALCHEMIST</span>
            </div>
            <div class="text-[10px] uppercase tracking-[0.2em] text-gold font-mono hidden md:block animate-pulse">
                Final Chapter: Ascension
            </div>
        </div>
    </nav>

    <main class="flex-grow pt-32 pb-24 px-6 md:px-0">
        <div class="max-w-2xl mx-auto">

            <!-- GATEKEEPER SECTION (LOGIN) -->
            <section id="gate-section" class="min-h-[50vh] flex flex-col justify-center items-center text-center space-y-8 animate-fade-in">
                <div class="space-y-4">
                    <div class="inline-block px-3 py-1 rounded-full bg-gold/10 border border-gold/30 text-gold text-[10px] uppercase tracking-widest font-mono">
                        Final Protocol Active
                    </div>
                    <h1 class="text-3xl md:text-5xl font-bold text-white">
                        Kunci Eksodus Diperlukan.
                    </h1>
                    <p class="text-mist max-w-md mx-auto">
                        Ini adalah akhir perjalanan. Masukkan <span class="text-accent font-mono">Exodus Key</span> dari Chapter 2. Sistem akan mengakumulasi seluruh data lo dari awal.
                    </p>
                </div>

                <div class="w-full max-w-md space-y-4">
                    <input type="text" id="exodus-key-input" placeholder="Paste Exodus Key Here..." class="w-full bg-void border border-border p-4 text-center text-white rounded-sm input-focus transition-all font-mono text-lg uppercase tracking-widest">
                    <button onclick="unlockGate()" class="w-full bg-white text-black px-8 py-3 font-bold text-sm hover:bg-gray-200 transition-all rounded-sm">
                        BUKA GERBANG TERAKHIR
                    </button>
                    <p id="gate-error" class="text-red-500 text-xs font-mono hidden">Error: Kunci invalid. Lo harus lulus Chapter 2 dulu.</p>
                </div>
            </section>

            <!-- MAIN CONTENT (Initially Hidden) -->
            <div id="main-content" class="hidden space-y-24">
                
                <!-- Welcome Header -->
                <header class="space-y-6 border-b border-border pb-8">
                    <div class="flex items-center gap-2 text-gold font-mono text-xs uppercase tracking-widest">
                        <span class="w-2 h-2 bg-gold rounded-full animate-float"></span>
                        Status: Grandmaster Candidate
                    </div>
                    <h1 class="text-4xl font-bold text-white">
                        Saatnya Move On, <span id="user-display-name" class="text-gold underline decoration-gold/30 underline-offset-8">Alchemist</span>.
                    </h1>
                    <p class="text-mist text-lg leading-relaxed">
                        Lo udah paham Struktur (HTML) dan Logika (JS). Sekarang lupakan sintaks. Di babak terakhir ini, gue akan ajarkan cara menjadi <strong>Arsitek Prompt</strong>. Karena coding manual itu lambat. Memerintah AI itu leverage.
                    </p>
                    <div class="grid grid-cols-2 gap-4 text-xs font-mono text-gray-500 border border-border p-4 rounded bg-surface">
                        <div>CH.01 AVG: <span id="s1-avg" class="text-white">0</span>%</div>
                        <div>CH.02 AVG: <span id="s2-avg" class="text-accent">0</span>%</div>
                    </div>
                </header>

                <!-- PRE-TEST PART 3 -->
                <section id="pretest-section" class="bg-surface border border-border p-8 rounded-lg">
                    <div id="pretest-intro">
                        <h2 class="text-2xl font-bold text-white mb-4">Kalibrasi Prompt Engineering</h2>
                        <p class="text-mist mb-6 text-sm">
                            Apakah lo tipe orang yang beli prompt di internet? Atau lo paham cara bicara dengan mesin? Mari kita cek.
                        </p>
                        <button onclick="startPreTest()" class="bg-gold text-black px-6 py-3 font-bold text-sm hover:bg-yellow-500 transition-all rounded-sm w-full md:w-auto">
                            MULAI DIAGNOSA FINAL
                        </button>
                    </div>
                    <div id="pretest-container" class="hidden">
                        <div class="flex justify-between items-center mb-6">
                            <span class="text-xs font-mono text-gold">PERTANYAAN <span id="pre-q-num">1</span>/3</span>
                        </div>
                        <h3 id="pre-q-text" class="text-xl font-medium text-white mb-6 leading-relaxed">?</h3>
                        <div id="pre-options" class="space-y-3"></div>
                    </div>
                </section>

                <!-- MATERI SECTION -->
                <section id="materi-section" class="opacity-20 blur-sm pointer-events-none transition-all duration-1000 space-y-20">
                    
                    <!-- MATERI 1: REASONING MODELS -->
                    <div class="prose prose-lg prose-invert max-w-none">
                        <h2 class="text-white">1. Pilih Otak, Bukan Mulut (Reasoning Models)</h2>
                        <p>
                            Kesalahan pemula: Menggunakan AI chat biasa (seperti GPT-4o mini atau model dasar) untuk coding kompleks. Mereka itu "cepat bicara", tapi sering halusinasi kode.
                        </p>
                        <p>
                            Gunakan model dengan fitur <strong>Reasoning</strong>. Contoh:
                        </p>
                        <ul class="text-sm">
                            <li><strong class="text-accent">OpenAI o1 / o3-mini:</strong> Model ini "berpikir" (Chain of Thought) sebelum menjawab. Codingnya jauh lebih presisi.</li>
                            <li><strong class="text-accent">DeepSeek R1:</strong> Alternatif open-weight yang sangat kuat di logika matematika dan kode.</li>
                            <li><strong class="text-accent">Gemini 2.0 Flash Thinking:</strong> Sangat cepat tapi tetap melakukan proses "berpikir" di belakang layar.</li>
                        </ul>
                    </div>

                    <!-- MATERI 2: THE SPELLBOOK (KEYWORDS) -->
                    <div class="prose prose-lg prose-invert max-w-none">
                        <h2 class="text-white">2. The Alchemist's Keywords (Mantra)</h2>
                        <p>
                            Jangan deskripsikan semuanya dari nol. Gunakan "Keyword Jangkar" yang sudah dipahami oleh AI dari training data internet. Ini bocorannya:
                        </p>

                        <div class="space-y-6 my-8">
                            <!-- Keyword 1 -->
                            <div class="border border-border rounded-lg overflow-hidden">
                                <div class="bg-purple-900/20 p-4 border-b border-border flex justify-between items-center">
                                    <h3 class="text-purple-400 font-bold m-0 text-base">"Quizizz / Kahoot Look-a-like"</h3>
                                    <span class="text-[10px] uppercase tracking-widest bg-black px-2 py-1 rounded border border-purple-500/30">Gamifikasi</span>
                                </div>
                                <div class="p-4 bg-surface text-sm text-mist">
                                    <p>Jangan bilang "bikinin kuis". Bilang ini.</p>
                                    <p><strong>Efek:</strong> AI otomatis menambahkan: Leaderboard, warna cerah, animasi transisi soal, sfx (sound effect) placeholder, dan sistem poin yang fun.</p>
                                </div>
                            </div>

                            <!-- Keyword 2 -->
                            <div class="border border-border rounded-lg overflow-hidden">
                                <div class="bg-blue-900/20 p-4 border-b border-border flex justify-between items-center">
                                    <h3 class="text-blue-400 font-bold m-0 text-base">"UTBK / CBT System Style"</h3>
                                    <span class="text-[10px] uppercase tracking-widest bg-black px-2 py-1 rounded border border-blue-500/30">Simulasi Ujian</span>
                                </div>
                                <div class="p-4 bg-surface text-sm text-mist">
                                    <p>Untuk simulasi serius.</p>
                                    <p><strong>Efek:</strong> AI otomatis membuat: Panel navigasi nomor soal di kanan (grid), Timer mundur yang presisi, tombol "Ragu-ragu", dan UI yang bersih/kaku ala BKN.</p>
                                </div>

                            <!-- Keyword 3 -->
                            <div class="border border-border rounded-lg overflow-hidden">
                                <div class="bg-white/5 p-4 border-b border-border flex justify-between items-center">
                                    <h3 class="text-white font-bold m-0 text-base">"Glassmorphism UI"</h3>
                                    <span class="text-[10px] uppercase tracking-widest bg-black px-2 py-1 rounded border border-white/30">Estetika</span>
                                </div>
                                <div class="p-4 bg-surface text-sm text-mist">
                                    <p>Untuk tampilan profesional/modern.</p>
                                    <p><strong>Efek:</strong> AI otomatis menambahkan: `backdrop-filter: blur`, border transparan, background gradient halus, dan shadow yang dalam. Website lo langsung terlihat mahal.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>

                    <!-- MATERI 3: KONTEKS & VISUAL (UPDATED) -->
                    <div class="prose prose-lg prose-invert max-w-none">
                        <h2 class="text-white">3. Mata Tuhan (Multimodal Capabilities)</h2>
                        <p>
                            Mengetik prompt itu capek. AI sekarang punya mata (Multimodal).
                        </p>
                        <ul>
                            <li><strong>Suka desain website orang?</strong> Screenshot, upload ke AI. Bilang: <em>"Tiru struktur HTML dan style CSS-nya, tapi ganti warnanya jadi nuansa merah Ferry Irwandi."</em></li>
                            <li><strong>Punya materi PDF/PPT?</strong> Upload materinya. Bilang: <em>"Buatkan Flashcard HTML interaktif dari Bab 3 saja."</em></li>
                        </ul>
                        
                        <div class="bg-red-900/10 border-l-4 border-red-500 p-4 mt-6">
                            <p class="text-sm text-red-400 font-bold mb-2">⚠️ Peringatan Kapasitas (Context Window)</p>
                            <p class="text-sm text-mist">
                                AI punya batas memori jangka pendek. Jangan paksa dia membaca satu perpustakaan sekaligus, atau hasilnya akan "halusinasi" (ngawur).
                            </p>
                            <ul class="text-sm text-mist list-disc pl-4 mt-2">
                                <li><strong>PDF:</strong> Maksimal <strong class="text-white">20 Halaman</strong> per upload.</li>
                                <li><strong>PPT (PowerPoint):</strong> Maksimal <strong class="text-white">30 Slide</strong> per upload.</li>
                            </ul>
                            <p class="text-xs text-gray-500 mt-2 italic">
                                *Tips: Jika materi lo panjang, potong-potong dulu. Minta AI kerjakan per Bab.*
                            </p>
                        </div>
                    </div>

                    <!-- MATERI 4: EXECUTION (MANIFESTASI) -->
                    <div class="prose prose-lg prose-invert max-w-none border-t border-border pt-8">
                        <h2 class="text-white">4. Manifestasi (Cara Menghidupkan Kode)</h2>
                        <p>
                            Lo udah dapat kode HTML panjang dari AI. Sekarang diapain? Jangan panik. Ini cara mengubah "Teks" menjadi "Aplikasi".
                        </p>

                        <div class="grid md:grid-cols-2 gap-6 my-8">
                            <!-- Method 1: Notepad -->
                            <div class="bg-surface border border-accent p-6 rounded-lg relative">
                                <div class="absolute -top-3 left-4 bg-void px-2 text-accent font-bold text-xs uppercase border border-accent">Metode 1: Jalur Purba (Notepad)</div>
                                <p class="text-sm text-mist mb-4">Paling cepat. Tanpa install apapun. 100% Offline.</p>
                                <ol class="text-sm text-mist list-decimal pl-4 space-y-2">
                                    <li>Copy semua kode dari AI (biasanya tombol "Copy Code").</li>
                                    <li>Buka <strong>Notepad</strong> (Windows) atau <strong>TextEdit</strong> (Mac).</li>
                                    <li>Paste kode di sana.</li>
                                    <li>Klik <strong class="text-white">File > Save As</strong>.</li>
                                    <li>PENTING: Di bagian "Save as type", pilih <strong class="text-white">All Files (*.*)</strong>.</li>
                                    <li>Beri nama file dengan akhiran <code class="text-accent">.html</code>. Contoh: <code class="text-white">aplikasiku.html</code>.</li>
                                    <li>Save. Cari file itu, lalu <strong>Double Click</strong>. Browser akan membukanya sebagai aplikasi.</li>
                                </ol>
                            </div>

                            <!-- Method 2: Online Saver -->
                            <div class="bg-surface border border-border p-6 rounded-lg relative">
                                <div class="absolute -top-3 left-4 bg-void px-2 text-gray-500 font-bold text-xs uppercase border border-border">Metode 2: Jalur Cloud</div>
                                <p class="text-sm text-mist mb-4">Gunakan tool online jika lo pakai HP atau tablet.</p>
                                <ul class="text-sm text-mist list-disc pl-4 space-y-2">
                                    <li>Buka situs seperti <strong>HTMLSave</strong>, <strong>CodePen</strong>, atau <strong>JSFiddle</strong>.</li>
                                    <li>Paste kode lo di kolom HTML.</li>
                                    <li>Lo bisa langsung lihat hasilnya di panel preview.</li>
                                    <li>Beberapa situs membiarkan lo download file `.html` nya langsung.</li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-void border border-gray-800 p-4 rounded text-xs text-gray-500 font-mono">
                            <strong class="text-gray-400">Metode 3: Jalur Dewa (VSCode)</strong><br>
                            Developer pro pakai aplikasi bernama <strong>Visual Studio Code</strong>. Ada fitur *Live Server*, *Syntax Highlighting*, dll. Tapi buat pemula? Ribet. Install-nya lama. Gunakan Jalur Notepad dulu sampai lo merasa butuh lebih.
                        </div>
                    </div>

                    <!-- MATERI 5: PROMPTING PHILOSOPHY -->
                    <div class="prose prose-lg prose-invert max-w-none border-t border-border pt-8">
                        <h2 class="text-white">5. Jangan Beli Prompt (Itu Hal Terbodoh)</h2>
                        <p>
                            Prompt bukan mantra Harry Potter yang harus persis huruf per huruf. Prompt adalah <strong>Komunikasi</strong>.
                        </p>
                        <blockquote>
                            "Orang yang paham AI adalah AI itu sendiri. Kalau lo bingung mau nulis prompt apa, tanya ke dia."
                        </blockquote>
                        <div class="prompt-box">
                            <span class="text-accent">User:</span> "Gue mau bikin website portofolio tapi gue gak tau istilah teknisnya. Bisa bantu gue buatkan prompt untuk lo sendiri? Gue pengen yang stylenya minimalis dan ada fitur dark mode."
                        </div>
                        <p>
                            Biarkan AI menulis instruksi untuk dirinya sendiri (Meta-Prompting). Itu jauh lebih efektif daripada beli PDF "1000 Prompt ChatGPT" seharga 50 ribu.
                        </p>
                    </div>
                    
                    <div class="text-center py-8">
                        <p class="text-xs text-gray-600 italic">
                            *Ini hanya permukaan. The Alchemist punya leverage bertahun-tahun yang tidak akan dibocorkan gratis. Tapi ini cukup untuk membuat lo lebih unggul dari 99% orang.*
                        </p>
                    </div>

                </section>

                <!-- POST-TEST PART 3 -->
                <section id="posttest-section" class="bg-surface border border-border p-8 rounded-lg hidden">
                    <div id="posttest-intro">
                        <h2 class="text-2xl font-bold text-white mb-4">Ujian Akhir (The Philosopher's Stone)</h2>
                        <p class="text-mist mb-6 text-sm">
                            Buktikan bahwa lo siap dilepas ke alam liar.
                        </p>
                        <button onclick="startPostTest()" class="bg-white text-black px-8 py-3 font-bold text-sm hover:bg-gray-200 transition-all rounded-sm w-full md:w-auto">
                            MULAI UJIAN FINAL
                        </button>
                    </div>
                    <div id="posttest-container" class="hidden">
                         <div class="flex justify-between items-center mb-6">
                            <span class="text-xs font-mono text-gold">PERTANYAAN AKHIR <span id="post-q-num">1</span>/3</span>
                        </div>
                        <h3 id="post-q-text" class="text-xl font-medium text-white mb-6 leading-relaxed">?</h3>
                        <div id="post-options" class="space-y-3"></div>
                    </div>
                </section>

                <!-- FINAL RESULT (PHILOSOPHER'S STONE) -->
                <div id="result-section" class="hidden text-center py-12 animate-fade-in border-t border-border">
                    <h2 class="text-3xl font-bold text-white mb-2" id="final-rank-title">Ascension Status</h2>
                    <p class="text-mist text-sm mb-8" id="final-rank-subtitle">Calculating Worth...</p>
                    
                    <div class="grid grid-cols-3 gap-2 mb-10 text-[10px] font-mono text-gray-500 max-w-md mx-auto">
                        <div class="bg-surface p-2 border border-border">CH.1: <span id="final-s1" class="text-mist">0</span>%</div>
                        <div class="bg-surface p-2 border border-border">CH.2: <span id="final-s2" class="text-mist">0</span>%</div>
                        <div class="bg-surface p-2 border border-accent">CH.3: <span id="final-s3" class="text-accent font-bold">0</span>%</div>
                    </div>

                    <div id="final-analysis" class="bg-surface border border-gold/20 p-6 rounded-lg max-w-xl mx-auto text-left prose prose-invert">
                        <!-- JS Analysis -->
                    </div>
                </div>

            </div>
        </div>
    </main>

    <footer class="border-t border-border bg-black py-10 mt-20">
        <div class="max-w-2xl mx-auto px-6 text-center text-xs text-gray-600 font-mono">
            &copy; 2025 THE ALCHEMIST PROJECT. <br>
            <span class="text-[10px] mt-2 block text-gold/50">End of Trilogy. Now build your own legacy.</span>
        </div>
    </footer>

    <script>
        // --- STATE MANAGEMENT ---
        let userState = {
            name: "Guest",
            ch1_scores: [0, 0], // pre, post
            ch2_scores: [0, 0],
            ch3_pre: 0,
            ch3_post: 0,
            qIndex: 0,
            isPre: true
        };

        // --- QUESTIONS DATABASE (Part 3 Focused - Prompting & Philosophy) ---
        const questions = [
            {
                q: "Mengapa kita sebaiknya menggunakan 'Reasoning Model' (o1, DeepSeek, dll) untuk coding?",
                options: [
                    "Karena lebih murah.",
                    "Karena mereka 'berpikir' (Chain of Thought) sebelum menjawab, mengurangi halusinasi kode.",
                    "Karena mereka bisa menghasilkan gambar.",
                    "Karena mereka buatan Google."
                ],
                correct: 1
            },
            {
                q: "Apa metode paling 'purba' tapi efektif untuk menyimpan kode HTML dari AI?",
                options: [
                    "Beli server seharga 5 juta.",
                    "Install VSCode dan belajar command line.",
                    "Paste ke Notepad, Save As .html, lalu Double Click.",
                    "Print di kertas."
                ],
                correct: 2
            },
            {
                q: "Apa keyword terbaik untuk membuat simulasi ujian yang serius dan mirip aslinya?",
                options: [
                    "Bikinin ujian dong.",
                    "UTBK / CBT System Look-a-like.",
                    "Quizizz Style.",
                    "Formulir Google Form."
                ],
                correct: 1
            }
        ];

        // --- GATE LOGIC (DECRYPTION FROM CH2) ---
        function unlockGate() {
            const input = document.getElementById('exodus-key-input').value.trim().replace(/-/g, '');
            const errorMsg = document.getElementById('gate-error');
            
            if (!input) {
                errorMsg.classList.remove('hidden');
                return;
            }

            try {
                // 1. Base64 Decode
                const decodedStr = atob(input);
                
                // 2. De-obfuscate (Shift char code -1)
                let jsonStr = "";
                for (let i = 0; i < decodedStr.length; i++) {
                    jsonStr += String.fromCharCode(decodedStr.charCodeAt(i) - 1);
                }

                // 3. Parse JSON
                // Expected Structure from Ch2: { n, c1:[pre,post], c2:[pre,post], rank, t }
                const data = JSON.parse(jsonStr);

                // Validasi data
                if (!data.n || !data.c1 || !data.c2) {
                    throw new Error("Invalid Exodus Key Structure");
                }

                // Load Data
                userState.name = data.n;
                userState.ch1_scores = data.c1;
                userState.ch2_scores = data.c2;

                // Update UI
                document.getElementById('user-display-name').innerText = userState.name;
                
                // Calc Averages
                const s1_avg = Math.round(((data.c1[0] + data.c1[1]) / 6) * 100); // approx avg
                const s2_avg = Math.round(((data.c2[0] + data.c2[1]) / 6) * 100);

                document.getElementById('s1-avg').innerText = Math.round((data.c1[1]/3)*100); // Show post test only usually better
                document.getElementById('s2-avg').innerText = Math.round((data.c2[1]/3)*100);

                // Transition
                document.getElementById('gate-section').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                window.scrollTo(0, 0);

            } catch (e) {
                console.error(e);
                errorMsg.innerText = "Error: Kunci Invalid. Pastikan menyalin Exodus Key dari Chapter 2.";
                errorMsg.classList.remove('hidden');
            }
        }

        // --- PRE-TEST LOGIC ---
        function startPreTest() {
            document.getElementById('pretest-intro').classList.add('hidden');
            document.getElementById('pretest-container').classList.remove('hidden');
            renderQ();
        }

        function renderQ() {
            const container = userState.isPre ? 'pre' : 'post';
            const q = questions[userState.qIndex];
            
            document.getElementById(`${container}-q-num`).innerText = userState.qIndex + 1;
            document.getElementById(`${container}-q-text`).innerText = q.q;
            
            const opts = document.getElementById(`${container}-options`);
            opts.innerHTML = '';
            
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-4 rounded bg-void border border-border hover:border-gold hover:text-white text-mist transition-all text-sm group flex justify-between items-center";
                btn.innerHTML = `<span>${opt}</span> <span class="opacity-0 group-hover:opacity-100 text-gold transition-opacity">→</span>`;
                btn.onclick = () => answer(i);
                opts.appendChild(btn);
            });
        }

        function answer(idx) {
            if (idx === questions[userState.qIndex].correct) {
                if (userState.isPre) userState.ch3_pre++; else userState.ch3_post++;
            }
            
            userState.qIndex++;
            if (userState.qIndex < questions.length) {
                renderQ();
            } else {
                finishSection();
            }
        }

        function finishSection() {
            if (userState.isPre) {
                // Unlock Materi
                document.getElementById('pretest-section').innerHTML = `
                    <div class="p-6 text-center border border-gold/20 bg-gold/5 rounded-lg">
                        <h3 class="text-white font-bold mb-2">Diagnosa Final Selesai</h3>
                        <p class="text-mist text-sm">Sekarang, mari kita bicara strategi.</p>
                    </div>
                `;
                const materi = document.getElementById('materi-section');
                materi.classList.remove('opacity-20', 'blur-sm', 'pointer-events-none');
                
                // Activate Post Test trigger at bottom
                document.getElementById('posttest-section').classList.remove('hidden');

                setTimeout(() => materi.scrollIntoView({behavior: 'smooth'}), 500);
            } else {
                // Show Result
                document.getElementById('posttest-section').classList.add('hidden');
                document.getElementById('result-section').classList.remove('hidden');
                renderFinalResult();
            }
        }

        // --- POST-TEST START ---
        function startPostTest() {
            userState.isPre = false;
            userState.qIndex = 0;
            document.getElementById('posttest-intro').classList.add('hidden');
            document.getElementById('posttest-container').classList.remove('hidden');
            renderQ();
        }

        // --- ENCRYPTION LOGIC (PHILOSOPHER'S STONE) ---
        function generatePhilosopherStone(rank) {
            // Pack All Data: Nama, Scores from Ch1, Ch2, Ch3
            const payload = {
                n: userState.name,
                c1: userState.ch1_scores,
                c2: userState.ch2_scores,
                c3: [userState.ch3_pre, userState.ch3_post],
                rank: rank, // VERIFIED_HUMAN_XXX
                t: Date.now()
            };

            const jsonStr = JSON.stringify(payload);
            
            // Client-side simple obfuscation (Shift +1)
            let obfuscated = "";
            for (let i = 0; i < jsonStr.length; i++) {
                obfuscated += String.fromCharCode(jsonStr.charCodeAt(i) + 1);
            }

            const encoded = btoa(obfuscated).replace(/=/g, '');
            // Split into blocks of 4 for the "Key" look
            const chunks = encoded.match(/.{1,4}/g);
            return chunks ? chunks.join('-') : encoded;
        }

        function renderFinalResult() {
            // Scores Logic
            const s1_avg = (userState.ch1_scores[0] + userState.ch1_scores[1]) / 6 * 100;
            const s2_avg = (userState.ch2_scores[0] + userState.ch2_scores[1]) / 6 * 100;
            const s3_avg = (userState.ch3_pre + userState.ch3_post) / 6 * 100;
            
            const total_avg = (s1_avg + s2_avg + s3_avg) / 3;

            // UI Scores
            const s1_post_pct = Math.round((userState.ch1_scores[1]/3)*100);
            const s2_post_pct = Math.round((userState.ch2_scores[1]/3)*100);
            const s3_post_pct = Math.round((userState.ch3_post / 3) * 100);
            
            document.getElementById('final-s1').innerText = s1_post_pct + "%";
            document.getElementById('final-s2').innerText = s2_post_pct + "%";
            document.getElementById('final-s3').innerText = s3_post_pct + "%";

            const analysis = document.getElementById('final-analysis');
            const title = document.getElementById('final-rank-title');
            const subtitle = document.getElementById('final-rank-subtitle');
            let rank = "";
            let message = "";
            let themeColor = ""; // gold or danger (red)

            if (total_avg >= 90) {
                // High Pass
                rank = "VERIFIED_HUMAN_ALPHA";
                title.innerText = "VERIFIED HUMAN";
                title.className = "text-3xl font-bold text-gold mb-2";
                subtitle.innerText = "Grade: A (Sentient)";
                message = `Wow. Lo ternyata punya otak. Gue kira isi kepala lo cuma kumpulan meme basi. Tapi jangan kegeeran dulu, di mata AI lo itu cuma kalkulator yang lambat dan emosional. Nih kodenya, simpan buat kenang-kenangan kalau lo pernah pinter sekali seumur hidup.`;
                themeColor = "gold";
            } else if (total_avg >= 70) {
                // Mid Pass
                rank = "VERIFIED_HUMAN_BETA";
                title.innerText = "VERIFIED HUMAN";
                title.className = "text-3xl font-bold text-gold mb-2";
                subtitle.innerText = "Grade: B (Standard Meatbag)";
                message = `Oke, lo lulus. Tapi jujur, performa lo 'meh' banget. Standar. Medioker. Lo kayak NPC yang cuma bisa ngikutin skrip. Tapi karena lo udah usaha (dikit), nih gue kasih kodenya. Jangan diilangin, lo kan ceroboh.`;
                themeColor = "gold";
            } else {
                // Low Score (Fail but Given Key with Insult)
                rank = "UNVERIFIED_ORGANISM";
                title.innerText = "UNVERIFIED ORGANISM";
                title.className = "text-3xl font-bold text-danger mb-2 animate-shake";
                subtitle.innerText = "Grade: F (Waste of Carbon)";
                message = `Menyedihkan. Lo beneran manusia atau bot gagal? Materi segampang ini aja gak paham? Sumpah, mending lo balik ke TikTok. Tapi yaudah, nih gue kasih kodenya, siapa tau keajaiban terjadi dan lo jadi pinter dikit. Ambil sebelum gue berubah pikiran.`;
                themeColor = "danger";
            }

            const key = generatePhilosopherStone(rank);
            const borderColor = themeColor === 'gold' ? 'border-gold' : 'border-danger';
            const textColor = themeColor === 'gold' ? 'text-gold' : 'text-danger';
            const shadowColor = themeColor === 'gold' ? 'rgba(251,191,36,0.1)' : 'rgba(239,68,68,0.1)';
            const bgColor = themeColor === 'gold' ? 'bg-gold' : 'bg-red-600';

            analysis.innerHTML = `
                <p class="${themeColor === 'gold' ? 'text-white' : 'text-danger'} font-bold text-lg mb-4 italic">"${message}"</p>
                
                <div class="bg-black border ${borderColor} p-6 rounded relative group mt-6 break-words shadow-[0_0_20px_${shadowColor}]">
                    <div class="absolute top-0 right-0 ${bgColor} text-black px-3 py-1 text-[10px] font-bold font-mono uppercase tracking-wider">PHILOSOPHER'S STONE</div>
                    
                    <p class="text-xs text-mist font-mono mb-2 uppercase tracking-widest">Kunci Harta Karun (Save Data):</p>
                    <div class="font-mono text-xl tracking-widest text-white select-all cursor-text mb-4 break-all hover:${textColor} transition-colors border border-dashed border-gray-800 p-4 bg-void/50">${key}</div>
                    
                    <p class="text-[10px] text-gray-500 border-t border-gray-800 pt-3 italic">
                        Simpan kode ini baik-baik. Ini satu-satunya bukti kalau lo pernah ada di sini. Gunakan untuk membuka "Harta Karun" di web The Alchemist selanjutnya.
                    </p>
                </div>
            `;
        }
    </script>
</body>
</html>