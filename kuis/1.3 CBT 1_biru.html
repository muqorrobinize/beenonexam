<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIRU - CBT Blok 1.4 (Perbaikan Format)</title>
    <!-- Impor Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Impor Google Font (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Konfigurasi MathJax untuk render rumus kimia/matematika -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* CSS Kustom - Tema BIRU LAUT (Deep Ocean & Cyan Accent) */
        body {
            font-family: 'Inter', sans-serif;
            /* Background Biru Laut Dalam */
            background: linear-gradient(135deg, #013655 0%, #0277bd 100%);
            color: #e1f5fe; /* Biru sangat muda/putih kebiruan */
            user-select: none;
            padding: 1rem;
            transition: all 0.2s;
            overflow-y: auto;
        }

        /* Kontainer utama bergaya "glass" kebiruan */
        .quiz-container {
            background: rgba(1, 54, 85, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(2, 119, 189, 0.4);
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            padding: 1.5rem 2rem;
            width: 90%;
            max-width: 800px;
        }

        /* Styling Teks Umum */
        h1, .text-3xl, .text-4xl {
            font-weight: 700;
            color: #00e5ff; /* Cyan Accent Bright */
            text-shadow: 0 0 15px rgba(0, 229, 255, 0.4);
        }
        
        p, .text-lg, span { color: #b3e5fc; } /* Light Blue */
        
        #progress-text, #score-text, #final-score-text, #flashcard-progress {
            color: #4fc3f7;
            font-weight: 600;
            text-shadow: 0 0 5px rgba(79, 195, 247, 0.3);
        }

        /* Tombol aksi (Mulai/Ulangi/Menu) - Aksen Biru Terang */
        .action-btn {
            font-family: 'Inter', sans-serif;
            text-transform: uppercase;
            background-color: #0288d1; /* Blue standard */
            border: none;
            padding: 0.9rem 1.5rem;
            box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.4);
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            color: #ffffff;
            font-weight: 700;
            font-size: 1rem;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 0.75rem;
        }
        .action-btn:hover {
            background-color: #00bcd4; /* Cyan vivid */
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 188, 212, 0.6);
        }
        .action-btn:active {
            box-shadow: none;
            transform: translateY(0px);
        }
        .action-btn:disabled {
            background-color: #455a64;
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Tombol kembali ke menu - Darker Blue */
        .back-to-menu-btn {
            background-color: #0d47a1;
            color: #e1f5fe;
            font-size: 0.9rem;
            padding: 0.75rem 1rem;
            font-weight: 600;
            border: 1px solid #1565c0;
        }
        .back-to-menu-btn:hover { background-color: #1565c0; }

        /* Tombol Opsi Jawaban (Outline Style Modern) */
        .option-btn {
            font-family: 'Inter', sans-serif;
            background: rgba(2, 119, 189, 0.2);
            border: 1px solid #0277bd;
            display: block;
            width: 100%;
            margin-bottom: 1rem;
            text-align: left;
            padding: 1.25rem;
            font-size: 0.95rem;
            line-height: 1.5;
            color: #e1f5fe;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 0.75rem;
        }
        .option-btn:hover {
            transform: translateY(-2px);
            background: rgba(2, 136, 209, 0.4);
            border-color: #4fc3f7;
            box-shadow: 0 0 8px rgba(79, 195, 247, 0.3);
        }
        
        /* Style untuk jawaban yg dipilih di Mode Ujian */
        .option-btn.selected {
            background: rgba(79, 195, 247, 0.2);
            border-color: #4fc3f7;
            color: #4fc3f7;
        }
        
        /* Status Jawaban */
        .option-btn.correct {
            background-color: #00c853; /* Green standard */
            border-color: #69f0ae;
            color: #ffffff;
            font-weight: 600;
            box-shadow: 0 0 10px rgba(0, 200, 83, 0.4);
        }
        .option-btn.incorrect {
            background-color: #d50000; /* Red standard */
            border-color: #ff1744;
            color: #ffffff;
            font-weight: 600;
            box-shadow: 0 0 10px rgba(213, 0, 0, 0.4);
        }
        .option-btn.disabled { pointer-events: none; }
        
        /* Teks Pertanyaan */
        #question-text {
            font-size: 1.15rem;
            line-height: 1.75;
            min-height: 100px;
            margin-bottom: 2rem;
            color: #ffffff;
            font-weight: 600;
        }

        /* --- Style untuk Flashcard & Penjelasan Latihan --- */
        #flashcard {
            background: linear-gradient(145deg, #024d76, #013655);
            border: 1px solid #0277bd;
            min-height: 300px;
            padding: 1.5rem;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            border-radius: 1rem;
        }
        
        #flashcard-front, #flashcard-back {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #e1f5fe;
        }
        
        .card-label {
            font-size: 0.75rem;
            color: #4fc3f7;
            margin-bottom: 1rem;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.05em;
        }
        
        /* Kontainer untuk penjelasan */
        #flashcard-answer-list, #explanation-container, .review-explanations {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .flashcard-option-detailed {
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            font-size: 0.9rem;
            transition: all 0.2s;
            border: 1px solid #0277bd;
            background: rgba(1, 54, 85, 0.6);
        }
        .flashcard-option-detailed strong {
            display: block;
            font-weight: 600;
            color: #4fc3f7;
            margin-bottom: 0.25rem;
        }
        .flashcard-option-detailed span {
            font-size: 0.85rem;
            color: #b3e5fc;
            line-height: 1.5;
        }
        .flashcard-option-detailed.correct {
            background: rgba(0, 200, 83, 0.2);
            border-color: #00e676;
        }
        .flashcard-option-detailed.correct span { color: #e8f5e9; }
        .flashcard-option-detailed.incorrect {
            background: rgba(213, 0, 0, 0.3);
            border-color: #ff1744;
        }
        
        /* Style untuk Layar Review */
        .review-card {
            background: rgba(1, 54, 85, 0.7);
            padding: 1.5rem;
            border-radius: 1rem;
            border: 1px solid #0277bd;
        }
        .review-question {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #0277bd;
            color: #4fc3f7;
        }
        .review-options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }
        @media (min-width: 768px) {
            .review-options-grid { grid-template-columns: 1fr 1fr; }
        }
        .review-option {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            border: 1px solid transparent;
            color: #b3e5fc;
        }
        .review-option.neutral {
            background: rgba(2, 119, 189, 0.2);
            border-color: #0277bd;
        }
        .review-option.correct {
            background: rgba(0, 200, 83, 0.3);
            border-color: #00e676;
            color: #69f0ae;
            font-weight: 600;
        }
        .review-option.chosen-wrong {
            background: rgba(213, 0, 0, 0.3);
            border-color: #ff1744;
            color: #ff5252;
            font-weight: 600;
            text-decoration: line-through;
        }
        .review-explanations { margin-top: 1.5rem; }
        
        .hidden { display: none; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <!-- 1. Layar Mulai (Pilih Mode) -->
    <div id="start-screen" class="quiz-container text-center">
        <h1 class="text-3xl md:text-4xl mb-6">BIRU</h1>
        <p class="mb-10 text-lg">CBT BLOK 1.4 - 50 SOAL</p>
        <div class="flex flex-col">
            <button id="start-flashcard-btn" class="action-btn">Mode Flashcard</button>
            <button id="start-practice-btn" class="action-btn">Mode Latihan</button>
            <button id="start-exam-btn" class="action-btn">Mode Ujian</button>
        </div>
    </div>

    <!-- 2. Layar Kuis (Latihan & Ujian) (Tersembunyi) -->
    <div id="quiz-screen" class="quiz-container hidden w-full max-w-4xl">
        <!-- Info Progress & Skor -->
        <div class="flex justify-between items-center mb-6">
            <span id="progress-text">Soal 1 / 50</span>
            <span id="score-text">Skor: 0</span>
        </div>
        
        <!-- Area Soal -->
        <div id="question-text">
            Memuat pertanyaan...
        </div>

        <!-- Area Opsi Jawaban -->
        <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Opsi akan ditambahkan oleh JavaScript -->
        </div>
        
        <!-- Area Penjelasan (Hanya Mode Latihan) -->
        <div id="explanation-container" class="mt-6">
            <!-- Penjelasan akan muncul di sini -->
        </div>
        
        <!-- Tombol Lanjut (Hanya Mode Latihan) -->
        <div class="text-center mt-8">
            <button id="next-question-btn" class="action-btn text-lg hidden">
                Lanjut
            </button>
            <button class="back-to-menu-btn action-btn">Kembali ke Menu</button>
        </div>
    </div>
    
    <!-- 3. Layar Flashcard (Tersembunyi) -->
    <div id="flashcard-screen" class="quiz-container hidden w-full max-w-2xl">
        <!-- Progress Flashcard -->
        <span id="flashcard-progress" class="block text-center mb-6">1 / 50</span>
        
        <!-- Flashcard -->
        <div id="flashcard">
            <div id="flashcard-front">
                <span class="card-label">Istilah / Pertanyaan</span>
                <p>Memuat...</p>
            </div>
            <div id="flashcard-back" class="hidden">
                <span class="card-label">Penjelasan</span>
                <div id="flashcard-answer-list">
                    <!-- Konten diisi secara sinkron -->
                </div>
            </div>
        </div>
        
        <!-- Navigasi Flashcard -->
        <div class="flex justify-between mt-6">
            <button id="flashcard-prev" class="action-btn text-lg">&lt; Prev</button>
            <button id="flashcard-flip" class="action-btn text-lg">Balik</button>
            <button id="flashcard-next" class="action-btn text-lg">Next &gt;</button>
        </div>
        
        <div class="text-center mt-6">
            <button class="back-to-menu-btn action-btn">Kembali ke Menu</button>
        </div>
    </div>


    <!-- 4. Layar Hasil (Tersembunyi) -->
    <div id="result-screen" class="quiz-container text-center hidden">
        <h1 class="text-3xl mb-6">KUIS SELESAI!</h1>
        <p id="final-score-text" class="text-4xl my-10">SKOR ANDA: 0 / 50</p>
        <!-- Tombol Review BARU -->
        <div class="flex flex-col md:flex-row justify-center gap-4">
            <button id="review-button" class="action-btn text-xl hidden">Review Kuis</button>
            <button id="restart-button" class="action-btn text-xl">Ulangi Kuis</button>
        </div>
        <button class="back-to-menu-btn action-btn mt-6">Kembali ke Menu</button>
    </div>
    
    <!-- 5. Layar Review BARU (Tersembunyi) -->
    <div id="review-screen" class="quiz-container hidden w-full max-w-4xl">
        <h1 class="text-3xl mb-6 text-center">Review Kuis Anda</h1>
        
        <!-- Kontainer untuk semua soal review -->
        <div id="review-container" class="flex flex-col gap-6 max-h-[70vh] overflow-y-auto pr-2">
            <!-- Soal review akan di-generate di sini -->
        </div>
        
        <div class="text-center mt-8 flex flex-col md:flex-row justify-center gap-4">
             <button id="restart-from-review" class="action-btn text-xl">Ulangi Kuis</button>
             <button class="back-to-menu-btn action-btn">Kembali ke Menu</button>
        </div>
    </div>

    <script>
        // --- Data Soal (50 Soal dari File BIRU) ---
        // Data telah dikonversi ke format Object Keys agar kompatibel dengan engine CBT Merah
        const questions = [
            {
                question: "Mekanisme kelistrikan neuron sangat dipengaruhi oleh",
                options: ["Kalium", "Iodium", "Cesium", "Barium", "Ferrum"],
                correct: "Kalium",
                explanations: {
                    "Kalium": "BENAR. Ion kalium (K+) sangat penting untuk fase repolarisasi potensial aksi dan menjaga potensial membran istirahat.",
                    "Iodium": "SALAH. Komponen hormon tiroid.",
                    "Cesium": "SALAH.",
                    "Barium": "SALAH.",
                    "Ferrum": "SALAH. Komponen hemoglobin."
                }
            },
            {
                question: "Manakah diantara daftar berikut yang merupakan neuromodulator?",
                options: ["Norepinefrin", "Glutamat", "Endorphin", "Serotonin", "Glisin"],
                correct: "Endorphin",
                explanations: {
                    "Endorphin": "BENAR. Peptida opioid endogen yang bertindak sebagai neuromodulator (mengurangi nyeri).",
                    "Norepinefrin": "SALAH. Neurotransmitter simpatis.",
                    "Glutamat": "SALAH. Neurotransmitter eksitatorik utama.",
                    "Serotonin": "SALAH. Neurotransmitter mood.",
                    "Glisin": "SALAH. Neurotransmitter inhibitorik."
                }
            },
            {
                question: "Reseptor apakah yang menerima rangsangan dingin?",
                options: ["Meissner", "Vater pacini", "Ruffini", "Krause", "Merkel"],
                correct: "Krause",
                explanations: {
                    "Krause": "BENAR. Krause's end bulbs sensitif terhadap dingin.",
                    "Meissner": "SALAH. Sentuhan ringan.",
                    "Vater pacini": "SALAH. Tekanan dalam.",
                    "Ruffini": "SALAH. Panas/Regangan.",
                    "Merkel": "SALAH. Sentuhan ringan."
                }
            },
            {
                question: "Bagian Ujung medulla spinalis yang memiliki bentuk seperti kerucut dinamakan...",
                options: ["Cauda equina", "Conus medullaris", "Filum terminale", "Lumbar Enlargement", "Cervical Enlargement"],
                correct: "Conus medullaris",
                explanations: {
                    "Conus medullaris": "BENAR. Ujung inferior medula spinalis berbentuk kerucut (L1/L2).",
                    "Cauda equina": "SALAH. Kumpulan akar saraf (ekor kuda).",
                    "Filum terminale": "SALAH. Jaringan ikat penambat."
                }
            },
            {
                question: "Pengaturan tonus otot selama proses gerak ekstremitas melibatkan:",
                options: ["Thalamus", "Nuclei basalis", "Ganglion radiks posterior", "Girus postsentral", "Lobus oksipital"],
                correct: "Nuclei basalis",
                explanations: {
                    "Nuclei basalis": "BENAR. Berperan penting dalam inisiasi gerak dan pengaturan tonus otot.",
                    "Thalamus": "SALAH. Relay sensorik.",
                    "Girus postsentral": "SALAH. Sensorik primer."
                }
            },
            {
                question: "Lapisan yang termasuk cortex cerebri adalah...",
                options: ["Lapisan granular dalam", "Lapisan faskulata", "Lapisan glomerulosa", "Lapisan retikularis", "Lapisan medula"],
                correct: "Lapisan granular dalam",
                explanations: {
                    "Lapisan granular dalam": "BENAR. Lamina IV dari korteks serebri (neocortex).",
                    "Lapisan faskulata": "SALAH. Korteks adrenal.",
                    "Lapisan glomerulosa": "SALAH. Korteks adrenal.",
                    "Lapisan retikularis": "SALAH. Korteks adrenal."
                }
            },
            {
                question: "Organ yang masuk ke dalam neuroendokrin?",
                options: ["Hypothalamus", "Epithalamus", "Thalamus", "Pons", "Medulla Oblongata"],
                correct: "Hypothalamus",
                explanations: {
                    "Hypothalamus": "BENAR. Menghubungkan sistem saraf dan endokrin (via pituitari).",
                    "Thalamus": "SALAH. Relay sensorik."
                }
            },
            {
                question: "Dominasi saraf simpatis pada proses pengisian kandung kemih menyebabkan...",
                options: ["Relaksasi otot detrusor", "Relaksasi sfingter interna", "Kontraksi sfingter eksterna", "Kontraksi detrusor", "Pengosongan kandung kemih"],
                correct: "Relaksasi otot detrusor",
                explanations: {
                    "Relaksasi otot detrusor": "BENAR. Agar kandung kemih bisa terisi tanpa berkontraksi.",
                    "Kontraksi detrusor": "SALAH. Parasimpatis (berkemih)."
                }
            },
            {
                question: "Nn. S membaui makanan dan menimbulkan sekresi saliva. Reseptor yang terstimulasi adalah...",
                options: ["Reseptor β1 adrenergik", "Reseptor β2 adrenergik", "Reseptor α1 adrenergik", "Reseptor nikotinik kolinergik", "Reseptor muskarinik kolinergik"],
                correct: "Reseptor muskarinik kolinergik",
                explanations: {
                    "Reseptor muskarinik kolinergik": "BENAR. Parasimpatis menstimulasi sekresi kelenjar via reseptor muskarinik.",
                    "Reseptor β1 adrenergik": "SALAH. Jantung."
                }
            },
            {
                question: "Susunan saraf pusat dapat menghambat mekanisme refleks melalui...",
                options: ["IPSP di motor neuron refleks", "EPSP di motor neuron refleks", "Potensial aksi di neuron motor refleks", "Hambatan di reseptor sensor", "Hambatan di neuron sensor"],
                correct: "IPSP di motor neuron refleks",
                explanations: {
                    "IPSP di motor neuron refleks": "BENAR. Hiperpolarisasi motor neuron mencegah firing.",
                    "EPSP di motor neuron refleks": "SALAH. Memicu refleks."
                }
            },
            {
                question: "Bagian dari cerebrum yang mengatur tonus otot, koordinasi gerak lambat dan stabil...",
                options: ["Corpus callosum", "Ganglion nuclei", "area brodmann", "Cortex prefrontal", "Ganglia basalis"],
                correct: "Ganglia basalis",
                explanations: {
                    "Ganglia basalis": "BENAR. Pusat modulasi gerak involunter dan tonus.",
                    "Corpus callosum": "SALAH. Penghubung hemisfer."
                }
            },
            {
                question: "Persilangan jaras dari medula spinalis menuju cortex cerebri adalah",
                options: ["Crus cerebri", "Piramid", "Oliva", "Decussatio pyramidalis", "Medula oblongata"],
                correct: "Decussatio pyramidalis",
                explanations: {
                    "Decussatio pyramidalis": "BENAR. Tempat persilangan jaras kortikospinalis di medula oblongata.",
                    "Piramid": "SALAH. Struktur sebelum menyilang."
                }
            },
            {
                question: "Vaskularisasi area cerebrum bagian permukaan lateral adalah oleh ...",
                options: ["A. cerebri anterior", "A. communicans anterior", "A. cerebri media", "A. communicans posterior", "A. cerebri posterior"],
                correct: "A. cerebri media",
                explanations: {
                    "A. cerebri media": "BENAR. MCA mendarahi lateral hemisfer (wajah, tangan, bahasa).",
                    "A. cerebri anterior": "SALAH. Medial hemisfer (kaki).",
                    "A. cerebri posterior": "SALAH. Oksipital."
                }
            },
            {
                question: "Pernyataan berikut merupakan efek nervus otonom parasimpatis",
                options: ["Kontraksi rektum", "Relaksasi bronkus", "Menghambat produksi saliva", "Konstriksi pupil", "Meningkatkan denyut jantung"],
                correct: "Konstriksi pupil",
                explanations: {
                    "Konstriksi pupil": "BENAR. Miosis (pupil mengecil) saat istirahat.",
                    "Relaksasi bronkus": "SALAH. Simpatis.",
                    "Meningkatkan denyut jantung": "SALAH. Simpatis."
                }
            },
            {
                question: "Neurotransmitter utama yang mempengaruhi kanal ion Natrium secara langsung (Ionotropik)",
                options: ["Dopamine", "GABA", "Asetilkolin", "Glutamat", "Serotonin"],
                correct: "Glutamat",
                explanations: {
                    "Glutamat": "BENAR. Bekerja pada reseptor AMPA/NMDA (kanal ion Na+/Ca++).",
                    "GABA": "SALAH. Kanal Klorida (Cl-).",
                    "Dopamine": "SALAH. Metabotropik."
                }
            },
            {
                question: "Berikut ini yang tepat mengenai saraf otonom",
                options: ["efektornya ada yang berupa otot skelet", "Bekerja secara volunter", "Neurotransmitter pada preganglion berupa asetilkolin", "reseptor di organ efektor bersifat nicotinic", "Kontraksi bladder"],
                correct: "Neurotransmitter pada preganglion berupa asetilkolin",
                explanations: {
                    "Neurotransmitter pada preganglion berupa asetilkolin": "BENAR. Preganglion Simpatis & Parasimpatis sama-sama melepas ACh.",
                    "Bekerja secara volunter": "SALAH. Involunter.",
                    "efektornya ada yang berupa otot skelet": "SALAH. Otot polos/jantung."
                }
            },
            {
                question: "Pernyataan berikut yang tepat tentang saraf simpatis adalah",
                options: ["Serabut preganglion pendek", "Ganglia neuron terletak di dekat atau dengan organ target", "Serabut pascaganglion pendek", "Meningkatkan produksi saliva", "Kontraksi bladder"],
                correct: "Serabut preganglion pendek",
                explanations: {
                    "Serabut preganglion pendek": "BENAR. Ganglion simpatis terletak di trunkus simpatikus (dekat spinal cord), sehingga preganglion pendek.",
                    "Ganglia neuron terletak di dekat atau dengan organ target": "SALAH. Parasimpatis."
                }
            },
            {
                question: "Pada circulus arteriosus willisi, yang merupakan percabangan langsung dari a. vertebralis (via basilaris)",
                options: ["A. cerebri anterior", "A. komunikan anterior", "A. cerebri media", "A. komunikan posterior", "A. cerebri posterior"],
                correct: "A. cerebri posterior",
                explanations: {
                    "A. cerebri posterior": "BENAR. Cabang terminal dari A. Basilaris (yang dibentuk dari 2 A. Vertebralis).",
                    "A. cerebri media": "SALAH. Sirkulasi anterior (Carotis Interna)."
                }
            },
            {
                question: "Berikut ini merupakan komponen dasar terjadinya potensial aksi di akson",
                options: ["Mechanical gated channel", "Voltage gated channel", "Chemical gated channel", "Ligand", "Mielin"],
                correct: "Voltage gated channel",
                explanations: {
                    "Voltage gated channel": "BENAR. Kanal Na+ dan K+ berpintu tegangan memicu depolarisasi/repolarisasi.",
                    "Ligand": "SALAH. Sinaps."
                }
            },
            {
                question: "Ketika saraf parasimpatis terstimulasi akan menyebabkan",
                options: ["Pupil midriasis", "Frekuensi denyut jantung lebih cepat", "Jantung memompa lebih kuat", "Aktivitas pencernaan ditingkatkan", "Lipolisis"],
                correct: "Aktivitas pencernaan ditingkatkan",
                explanations: {
                    "Aktivitas pencernaan ditingkatkan": "BENAR. Rest and Digest.",
                    "Pupil midriasis": "SALAH. Simpatis.",
                    "Lipolisis": "SALAH. Simpatis."
                }
            },
            {
                question: "Bagian mesencephalon yang memproduksi dopamin",
                options: ["Red nucleus", "Colliculus superior", "Tectum", "Substantia nigra", "Pedunculus cerebri"],
                correct: "Substantia nigra",
                explanations: {
                    "Substantia nigra": "BENAR. Pars compacta memproduksi dopamin (rusak pada Parkinson).",
                    "Red nucleus": "SALAH. Motorik rubrospinal."
                }
            },
            {
                question: "Seorang kakek paham apa yg orang lain katakan, namun tidak bisa berbicara (ekspresif). Area manakah yang terkena lesi?",
                options: ["Area Brocha", "Area Brodmann 1,2,3", "Lobus parietal", "Area Wernicke", "Lobus Oksipital"],
                correct: "Area Brocha",
                explanations: {
                    "Area Brocha": "BENAR. Afasia motorik (tidak bisa bicara, tapi paham).",
                    "Area Wernicke": "SALAH. Afasia sensorik (bicara lancar tapi kacau, tidak paham)."
                }
            },
            {
                question: "Vena yang menghubungkan sistem vena ekstrakranial (kulit kepala) dan intrakranial (sinus) adalah",
                options: ["Vena Emissaria", "Pleksus pterygoid", "Vena meningea media", "Vena jugularis eksterna", "Vena jugularis interna"],
                correct: "Vena Emissaria",
                explanations: {
                    "Vena Emissaria": "BENAR. Jalur potensial penyebaran infeksi ke dalam kranium.",
                    "Vena jugularis interna": "SALAH. Vena drainase utama."
                }
            },
            {
                question: "Pada homunculus, yang paling besar bagian sistem saraf motorik pada otak adalah...",
                options: ["Mulut", "Mata", "Toraks dan abdomen", "Tangan", "Kaki"],
                correct: "Tangan",
                explanations: {
                    "Tangan": "BENAR. Area tangan (jari) dan wajah sangat luas karena gerakan halus.",
                    "Toraks dan abdomen": "SALAH. Sangat kecil."
                }
            },
            {
                question: "Organ berikut divaskularisasi oleh A. superior cerebellum (SCA) adalah...",
                options: ["Thalamus", "Cerebellum lobus inferior", "Medula oblongata", "Pons", "Mesencephalon"],
                correct: "Pons",
                explanations: {
                    "Pons": "BENAR. SCA mendarahi bagian superior cerebellum dan pons bagian rostral.",
                    "Thalamus": "SALAH. PCA."
                }
            },
            {
                question: "Cabang terakhir arteri carotis externa yang nantinya akan bercabang menjadi A. meningea media adalah...",
                options: ["a. superficial temporal", "a. maksilaris", "a. occipitalis", "a. facial"],
                correct: "a. maksilaris",
                explanations: {
                    "a. maksilaris": "BENAR. A. Meningea Media adalah cabang dari A. Maksilaris.",
                    "a. superficial temporal": "SALAH. Cabang terminal lain."
                }
            },
            {
                question: "Yang menjadi salah satu penyusun Blood Brain Barrier (Sawar Darah Otak) adalah..",
                options: ["Sel ependim", "Sel astrosit", "Sel piramidal", "Sel purkinje", "Sel schwann"],
                correct: "Sel astrosit",
                explanations: {
                    "Sel astrosit": "BENAR. Kaki perivaskular astrosit membungkus kapiler otak.",
                    "Sel schwann": "SALAH. SST."
                }
            },
            {
                question: "Apa nama struktur yang menjadi pusat sensorik primer",
                options: ["Gyrus precentral", "Gyrus postcentral", "Lobus parietal", "Lobus temporal", "Lobus oksipital"],
                correct: "Gyrus postcentral",
                explanations: {
                    "Gyrus postcentral": "BENAR. Area Brodmann 3,1,2 (Somatosensorik).",
                    "Gyrus precentral": "SALAH. Motorik."
                }
            },
            {
                question: "Jaringan ikat pembungkus saraf tepi terluar adalah",
                options: ["Perimisium", "Perineurium", "Endomisium", "Endometrium", "Epineurium"],
                correct: "Epineurium",
                explanations: {
                    "Epineurium": "BENAR. Membungkus seluruh saraf.",
                    "Perineurium": "SALAH. Membungkus fasikulus.",
                    "Endoneurium": "SALAH. Membungkus akson."
                }
            },
            {
                question: "Struktur yang termasuk prosencephalon (Otak Depan)?",
                options: ["Cerebrum", "Cerebellum", "Thalamus", "Medulla oblongata", "Pons"],
                correct: "Cerebrum",
                explanations: {
                    "Cerebrum": "BENAR. Turunan Telencephalon (bagian dari Prosencephalon).",
                    "Cerebellum": "SALAH. Rhombencephalon.",
                    "Thalamus": "BENAR. Diencephalon (juga bagian Prosencephalon), tapi Cerebrum jawaban utama."
                }
            },
            {
                question: "Nn. N mengalami stress berat... respon saraf fight or flight... Neurotransmitter apakah yang dimaksud?",
                options: ["Acetylcholin", "Serotonin", "Endorphine", "GABA", "Dopamine"],
                correct: "Dopamine",
                explanations: {
                    "Dopamine": "BENAR. Prekursor Norepinefrin/Epinefrin (Adrenalin) dan terkait respon stress/motivasi.",
                    "Acetylcholin": "SALAH. Parasimpatis."
                }
            },
            {
                question: "Seorang mahasiswa menemukan bahwa terdapat neuron yang menerima impuls dari berbagai neuron. Pusat integrasi tersebut terjadi di?",
                options: ["Soma", "Dendrit", "Akson", "Nodus Ranvier", "Ujung akson"],
                correct: "Soma",
                explanations: {
                    "Soma": "BENAR. Integrasi sinyal terjadi di Soma dan Axon Hillock.",
                    "Akson": "SALAH. Transmisi."
                }
            },
            {
                question: "Aktifitas berikut ini akan menimbulkan gelombang alfa di EEG",
                options: ["Duduk santai dengan mata terpejam", "belajar", "Olahraga", "Rem", "Deep sleep"],
                correct: "Duduk santai dengan mata terpejam",
                explanations: {
                    "Duduk santai dengan mata terpejam": "BENAR. Gelombang Alfa = Rileks tapi terjaga.",
                    "belajar": "SALAH. Beta.",
                    "Deep sleep": "SALAH. Delta."
                }
            },
            {
                question: "Pada kasus Phineas Cage tertusuk tongkat... perubahan kepribadian. Bagian apa yang mengalami kelainan",
                options: ["Lobus temporal", "Lobus occipital", "Lobus frontalis", "Gyrus precentral", "Lobus parietalis"],
                correct: "Lobus frontalis",
                explanations: {
                    "Lobus frontalis": "BENAR. Korteks prefrontal mengatur kepribadian dan kontrol impuls.",
                    "Lobus occipital": "SALAH. Visual."
                }
            },
            {
                question: "Cerebrum potongan coronal, struktur apa yang dapat diidentifikasi?",
                options: ["substantia grisea paling superficial", "substansia alba paling superficial", "substansia alba dan substansia grisea tidak bisa dibedakan", "sulcus centralis terlihat jelas", "Ventrikel terlihat di inferior"],
                correct: "substantia grisea paling superficial",
                explanations: {
                    "substantia grisea paling superficial": "BENAR. Korteks serebri (grisea) ada di luar, alba di dalam.",
                    "substansia alba paling superficial": "SALAH. Terbalik."
                }
            },
            {
                question: "Area cerebrum sebagai cortex sensoris primer",
                options: ["gyrus postcentralis", "gyrus precentralis", "lobus temporalis", "lobus occipitale", "lobus parietal"],
                correct: "gyrus postcentralis",
                explanations: {
                    "gyrus postcentralis": "BENAR. Area somatosensorik primer.",
                    "gyrus precentralis": "SALAH. Motorik."
                }
            },
            {
                question: "Ketika impuls sudah mencapai ujung akson, maka akan terjadi...",
                options: ["hiperpolarisasi", "depolarisasi", "pelepasan neurotransmitter", "reuptake neurotransmitter", "terjadi potensial aksi"],
                correct: "pelepasan neurotransmitter",
                explanations: {
                    "pelepasan neurotransmitter": "BENAR. Influks Ca++ memicu eksositosis neurotransmitter.",
                    "terjadi potensial aksi": "SALAH. Potensial aksi datang, menyebabkan pelepasan."
                }
            },
            {
                question: "Struktur otak yang aktivitasnya rendah pada orang dengan empati rendah dan enggan menolong",
                options: ["Lobus temporal", "Lobus occipital", "Korteks sensorik primer", "Korteks somatosensori", "Korteks prefrontal"],
                correct: "Korteks prefrontal",
                explanations: {
                    "Korteks prefrontal": "BENAR. Mengatur perilaku sosial, moral, dan empati.",
                    "Lobus occipital": "SALAH. Visual."
                }
            },
            {
                question: "Sel yang mengelilingi mielin di susunan saraf pusat?",
                options: ["sel ependim", "sel astrosit", "sel schwann", "sel oligodendrosit"],
                correct: "sel oligodendrosit",
                explanations: {
                    "sel oligodendrosit": "BENAR. Membentuk mielin di SSP.",
                    "sel schwann": "SALAH. Membentuk mielin di SST."
                }
            },
            {
                question: "Bagian otak berikut merupakan salah satu bagian diencephalon, yaitu",
                options: ["Korteks cerebri", "Ganglia basalis", "Hipotalamus", "Hipokampus", "Amigdala"],
                correct: "Hipotalamus",
                explanations: {
                    "Hipotalamus": "BENAR. Bagian dari Diencephalon bersama Thalamus.",
                    "Hipokampus": "SALAH. Sistem limbik (Telencephalon)."
                }
            },
            {
                question: "Beberapa refleks primitif menghilang selama proses tumbuh kembang. Hal ini terjadi melalui...",
                options: ["Pembentukan sinaps fasilitasi", "Pembentukan sinaps inhibisi", "Mielinisasi", "Modulasi sensorik", "Synaptic delay"],
                correct: "Pembentukan sinaps inhibisi",
                explanations: {
                    "Pembentukan sinaps inhibisi": "BENAR. Korteks motorik yang matang menekan (menginhibisi) refleks primitif batang otak.",
                    "Pembentukan sinaps fasilitasi": "SALAH."
                }
            },
            {
                question: "Motor neuron di kornu anterior medula spinalis yang berperan mengatur tonus otot adalah..",
                options: ["Alpha", "Beta", "Delta", "Gamma", "Tetha"],
                correct: "Gamma",
                explanations: {
                    "Gamma": "BENAR. Menginervasi serabut intrafusal (muscle spindle) untuk tonus.",
                    "Alpha": "SALAH. Kontraksi otot utama (ekstrafusal)."
                }
            },
            {
                question: "Apa fungsi sistem limbik",
                options: ["Pusat pencernaan", "Pusat kesadaran", "Koordinasi pergerakan", "Pusat ide", "Pusat emosi, afeksi, dan motivasi"],
                correct: "Pusat emosi, afeksi, dan motivasi",
                explanations: {
                    "Pusat emosi, afeksi, dan motivasi": "BENAR. 'Emotional Brain'.",
                    "Koordinasi pergerakan": "SALAH. Cerebellum/Basal Ganglia."
                }
            },
            {
                question: "Pengaturan atau kontrol fungsi Vegetatif (Vital) diperankan oleh...",
                options: ["diencephalon, mesencephalon", "hypothalamus, thalamus, epitalamus", "pons, medula oblongata, mesencephalon", "cerebrum, cerebellum", "sistem limbik"],
                correct: "pons, medula oblongata, mesencephalon",
                explanations: {
                    "pons, medula oblongata, mesencephalon": "BENAR. Batang otak mengontrol napas, jantung, dan tekanan darah.",
                    "cerebrum, cerebellum": "SALAH."
                }
            },
            {
                question: "Tempat Keluarnya Nervus Kranial IX, X, XI, XII adalah",
                options: ["Mesencephalon", "Pons", "Medula oblongata", "Cerebellum", "Medula spinalis"],
                correct: "Medula oblongata",
                explanations: {
                    "Medula oblongata": "BENAR. Tempat keluar saraf kranial kaudal.",
                    "Pons": "SALAH. V, VI, VII, VIII."
                }
            },
            {
                question: "Faktor pemicu terjadinya mengantuk dan tidur",
                options: ["Peningkatan ATP otak", "Pelepasan neurotransmitter NE", "Tekanan darah meningkat", "Kelelahan neuron", "Peningkatan aktivitas formation retikularis"],
                correct: "Kelelahan neuron",
                explanations: {
                    "Kelelahan neuron": "BENAR. Akumulasi adenosin (sisa metabolisme) menghambat arousal.",
                    "Peningkatan aktivitas formation retikularis": "SALAH. Bikin bangun."
                }
            },
            {
                question: "Fungsi formatio retikularis, kecuali",
                options: ["Somatic motor control", "Cardiovascular control", "Pain modulator", "Sleep and consciousness", "Perception"],
                correct: "Perception",
                explanations: {
                    "Perception": "BENAR. Persepsi adalah fungsi korteks serebri, bukan batang otak.",
                    "Sleep and consciousness": "SALAH. Ini fungsi utamanya (ARAS)."
                }
            },
            {
                question: "Hemisphere dextra dan sinistra dihubungkan melalui....",
                options: ["Corpus callosum", "Ventrikel lateral", "Aqueductus Sylvii", "Lobus temporal", "Gyrus precentral"],
                correct: "Corpus callosum",
                explanations: {
                    "Corpus callosum": "BENAR. Komisura terbesar penghubung kiri-kanan.",
                    "Ventrikel lateral": "SALAH."
                }
            },
            {
                question: "Petani terpapar pestisida organofosfat (inhibitor asetilkolinesterase). Hal tersebut menyebabkan kadar asetilkolin...",
                options: ["Penurunan secara signifikan", "Peningkatan Secara signifikan", "Tidak ada Perubahan"],
                correct: "Peningkatan Secara signifikan",
                explanations: {
                    "Peningkatan Secara signifikan": "BENAR. Enzim pemecah dihambat -> ACh menumpuk -> Kejang/Hipersalivasi.",
                    "Penurunan secara signifikan": "SALAH."
                }
            },
            {
                question: "Nervus cabang pleksus brachialis yang menginervasi m. deltoid adalah",
                options: ["Musculocutaneus", "Axilaris", "Radialis", "Medianus"],
                correct: "Axilaris",
                explanations: {
                    "Axilaris": "BENAR. Menginervasi Deltoid dan Teres Minor.",
                    "Musculocutaneus": "SALAH. Biceps."
                }
            }
        ];


        // --- Variabel Status Kuis ---
        let currentQuestionIndex = 0;
        let score = 0;
        const totalQuestions = questions.length;
        let currentMode = 'exam'; // 'exam', 'practice', 'flashcard'
        let currentFlashcardIndex = 0; // Untuk mode flashcard
        let userAnswers = []; // Untuk menyimpan jawaban mode ujian

        // --- Referensi Elemen DOM ---
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const flashcardScreen = document.getElementById('flashcard-screen');
        const reviewScreen = document.getElementById('review-screen'); 
        
        // Tombol Menu Utama
        const startFlashcardBtn = document.getElementById('start-flashcard-btn');
        const startPracticeBtn = document.getElementById('start-practice-btn');
        const startExamBtn = document.getElementById('start-exam-btn');
        
        // Tombol Hasil
        const restartButton = document.getElementById('restart-button');
        const reviewButton = document.getElementById('review-button'); 
        
        // Elemen Kuis
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const progressText = document.getElementById('progress-text');
        const scoreText = document.getElementById('score-text');
        const finalScoreText = document.getElementById('final-score-text');
        const nextQuestionButton = document.getElementById('next-question-btn');
        const explanationContainer = document.getElementById('explanation-container');
        
        // Elemen Flashcard
        const flashcard = document.getElementById('flashcard');
        const flashcardFront = document.getElementById('flashcard-front');
        const flashcardBack = document.getElementById('flashcard-back');
        const flashcardAnswerList = document.getElementById('flashcard-answer-list');
        const flashcardProgress = document.getElementById('flashcard-progress');
        const flashcardPrev = document.getElementById('flashcard-prev');
        const flashcardFlip = document.getElementById('flashcard-flip');
        const flashcardNext = document.getElementById('flashcard-next');
        
        // Elemen Review
        const reviewContainer = document.getElementById('review-container');
        const restartFromReviewBtn = document.getElementById('restart-from-review');
        
        // Tombol Kembali ke Menu
        const backToMenuButtons = document.querySelectorAll('.back-to-menu-btn');
        
        // --- Fungsi Navigasi Utama ---

        function showMainMenu() {
            quizScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            flashcardScreen.classList.add('hidden');
            reviewScreen.classList.add('hidden'); 
            startScreen.classList.remove('hidden');
            document.body.classList.add('items-center');
            document.body.classList.remove('pt-10');
        }

        function setBodyActive() {
            document.body.classList.remove('items-center');
            document.body.classList.add('pt-10');
        }

        // --- Logika Mode Flashcard ---

        function startFlashcardMode() {
            currentFlashcardIndex = 0;
            startScreen.classList.add('hidden');
            flashcardScreen.classList.remove('hidden');
            setBodyActive();
            showFlashcard();
        }

        function showFlashcard() {
            const question = questions[currentFlashcardIndex];
            flashcardFront.querySelector('p').innerText = question.question;
            flashcardAnswerList.innerHTML = ''; 
            flashcardFront.classList.remove('hidden');
            flashcardBack.classList.add('hidden');
            flashcardProgress.innerText = `${currentFlashcardIndex + 1} / ${totalQuestions}`;
            flashcardPrev.disabled = currentFlashcardIndex === 0;
            flashcardNext.disabled = currentFlashcardIndex === totalQuestions - 1;
            
            // Render MathJax jika ada rumus
            if (window.MathJax) {
                MathJax.typesetPromise([flashcardFront]);
            }
        }

        function flipFlashcard() {
            const isFlippingToBack = flashcardBack.classList.contains('hidden');
            if (isFlippingToBack) {
                const q = questions[currentFlashcardIndex];
                renderFlashcardExplanations(q.explanations, q.correct);
            }
            flashcardFront.classList.toggle('hidden');
            flashcardBack.classList.toggle('hidden');
            
            // Render MathJax saat dibalik
            if (window.MathJax && isFlippingToBack) {
                MathJax.typesetPromise([flashcardBack]);
            }
        }
        
        function renderFlashcardExplanations(explanationsObj, correctTerm) {
            flashcardAnswerList.innerHTML = ''; 
            const sortedTerms = Object.keys(explanationsObj).sort((a, b) => (a === correctTerm ? -1 : b === correctTerm ? 1 : 0));
            sortedTerms.forEach(term => {
                const explanation = explanationsObj[term];
                const isCorrect = (term === correctTerm);
                renderSingleExplanation(term, explanation, isCorrect, flashcardAnswerList);
            });
        }
        
        function prevFlashcard() {
            if (currentFlashcardIndex > 0) {
                currentFlashcardIndex--;
                showFlashcard();
            }
        }

        function nextFlashcard() {
            if (currentFlashcardIndex < totalQuestions - 1) {
                currentFlashcardIndex++;
                showFlashcard();
            }
        }

        // --- Logika Mode Kuis (Latihan & Ujian) ---

        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = []; // Kosongkan riwayat jawaban
            
            startScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            reviewScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            nextQuestionButton.classList.add('hidden');
            
            setBodyActive();
            showQuestion();
        }
        
        function startPracticeMode() {
            currentMode = 'practice';
            startQuiz();
        }
        
        function startExamMode() {
            currentMode = 'exam';
            startQuiz();
        }

        function showQuestion() {
            optionsContainer.innerHTML = '';
            explanationContainer.innerHTML = ''; 
            nextQuestionButton.classList.add('hidden');
            
            const question = questions[currentQuestionIndex];
            questionText.innerText = question.question;
            progressText.innerText = `Soal ${currentQuestionIndex + 1} / ${totalQuestions}`;
            
            // Mode Latihan menunjukkan skor real-time, Mode Ujian tidak
            if (currentMode === 'practice') {
                 scoreText.innerText = `Skor: ${score}`;
            } else {
                 scoreText.innerText = `Skor: -`;
            }
            
            const options = question.options;

            options.forEach(option => {
                const button = document.createElement('button');
                button.innerText = option;
                button.classList.add('option-btn');
                button.addEventListener('click', () => selectAnswer(option, button));
                optionsContainer.appendChild(button);
            });
            
            // Render MathJax untuk soal baru
            if (window.MathJax) {
                MathJax.typesetPromise([questionText, optionsContainer]);
            }
        }

        function selectAnswer(selectedOption, buttonEl) {
            const correctAnwer = questions[currentQuestionIndex].correct;

            // Nonaktifkan semua tombol opsi
            const optionButtons = optionsContainer.querySelectorAll('.option-btn');
            optionButtons.forEach(btn => btn.classList.add('disabled'));
            
            // Simpan jawaban (untuk kedua mode)
            userAnswers[currentQuestionIndex] = {
                chosen: selectedOption,
                correct: correctAnwer,
                isCorrect: selectedOption === correctAnwer
            };

            // Logika lanjut berdasarkan mode
            if (currentMode === 'practice') {
                // --- MODE LATIHAN ---
                if (selectedOption === correctAnwer) {
                    score++;
                    buttonEl.classList.add('correct');
                } else {
                    buttonEl.classList.add('incorrect');
                    optionButtons.forEach(btn => {
                        if (btn.innerText === correctAnwer) {
                            btn.classList.add('correct');
                        }
                    });
                }
                scoreText.innerText = `Skor: ${score}`;
                nextQuestionButton.classList.remove('hidden');
                renderPracticeExplanation(selectedOption, correctAnwer);
                
            } else {
                // --- MODE UJIAN ---
                // 1. Hanya sorot jawaban yang dipilih
                buttonEl.classList.add('selected');
                
                // 2. Auto-lanjut setelah delay singkat
                setTimeout(goToNextQuestion, 500); 
            }
        }
        
        function renderPracticeExplanation(chosenOption, correctOption) {
            explanationContainer.innerHTML = ''; 
            const explanations = questions[currentQuestionIndex].explanations;
            
            // Tampilkan penjelasan untuk semua opsi
            if (explanations) {
                Object.keys(explanations).forEach(term => {
                    const explanation = explanations[term];
                    const isCorrect = (term === correctOption);
                    const isChosen = (term === chosenOption);
                    
                    // Tampilkan jika benar atau jika dipilih (walau salah)
                    if(isCorrect || (isChosen && !isCorrect)) {
                        renderSingleExplanation(term, explanation, isCorrect, explanationContainer);
                    }
                });
            } else {
                // Fallback jika tidak ada detail explanation
                explanationContainer.innerHTML = `<div class="flashcard-option-detailed correct"><strong>${correctOption}</strong><span>Jawaban Benar</span></div>`;
            }
            
            if (window.MathJax) {
                MathJax.typesetPromise([explanationContainer]);
            }
        }
        
        // Fungsi render yang dibagikan
        function renderSingleExplanation(term, explanation, isCorrect, targetElement) {
            const optionEl = document.createElement('div');
            optionEl.classList.add('flashcard-option-detailed');
            
            if (isCorrect) {
                optionEl.classList.add('correct');
            } else {
                optionEl.classList.add('incorrect');
            }
            
            optionEl.innerHTML = `
                <strong>${term}</strong>
                <span>${explanation}</span>
            `;
            targetElement.appendChild(optionEl);
        }
        
        function goToNextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < totalQuestions) {
                showQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            let finalScore = 0;
            
            if (currentMode === 'exam') {
                // Hitung skor dari array userAnswers
                finalScore = userAnswers.filter(answer => answer && answer.isCorrect).length;
                reviewButton.classList.remove('hidden'); 
            } else {
                // Ambil skor real-time dari mode latihan
                finalScore = score;
                reviewButton.classList.add('hidden');
            }
            
            finalScoreText.innerText = `SKOR ANDA: ${finalScore} / ${totalQuestions}`;
            document.body.classList.add('items-center');
            document.body.classList.remove('pt-10');
        }
        
        // --- FUNGSI REVIEW BARU ---
        
        function showReviewScreen() {
            resultScreen.classList.add('hidden');
            reviewScreen.classList.remove('hidden');
            reviewContainer.innerHTML = ''; 
            setBodyActive(); 
            
            questions.forEach((question, index) => {
                const userAnswer = userAnswers[index] || { chosen: null }; 
                
                // Buat kartu review
                const reviewCard = document.createElement('div');
                reviewCard.classList.add('review-card');
                
                // Buat HTML untuk opsi
                let optionsHTML = '';
                question.options.forEach(option => {
                    let optionClass = 'review-option neutral';
                    if (option === question.correct) {
                        optionClass = 'review-option correct';
                    } else if (option === userAnswer.chosen) {
                        optionClass = 'review-option chosen-wrong';
                    }
                    
                    optionsHTML += `<div class="${optionClass}">${option}</div>`;
                });
                
                // Buat HTML untuk penjelasan
                let explanationsHTML = '';
                const explanations = question.explanations;
                const correctTerm = question.correct;
                
                if (explanations) {
                    const sortedTerms = Object.keys(explanations).sort((a, b) => {
                        if (a === correctTerm) return -1;
                        if (b === correctTerm) return 1;
                        if (a === userAnswer.chosen) return -1;
                        if (b === userAnswer.chosen) return 1;
                        return 0;
                    });
                    
                    sortedTerms.forEach(term => {
                        const explanation = explanations[term];
                        const isCorrect = (term === correctTerm);
                        
                        let explanationClass = 'flashcard-option-detailed';
                        if (isCorrect) {
                            explanationClass += ' correct';
                        } else {
                            explanationClass += ' incorrect';
                        }
                        
                        explanationsHTML += `
                            <div class="${explanationClass}">
                                <strong>${term}</strong>
                                <span>${explanation}</span>
                            </div>
                        `;
                    });
                }

                // Gabungkan semuanya
                reviewCard.innerHTML = `
                    <div class="review-question">Soal ${index + 1}: ${question.question}</div>
                    <div class="review-options-grid">${optionsHTML}</div>
                    <div class="review-explanations">${explanationsHTML}</div>
                `;
                
                reviewContainer.appendChild(reviewCard);
            });
            
            // Render MathJax pada layar review
            if (window.MathJax) {
                MathJax.typesetPromise([reviewContainer]);
            }
        }

        // --- Event Listeners ---
        
        // Menu Utama
        startFlashcardBtn.addEventListener('click', startFlashcardMode);
        startPracticeBtn.addEventListener('click', startPracticeMode);
        startExamBtn.addEventListener('click', startExamMode);
        
        // Layar Hasil
        restartButton.addEventListener('click', startQuiz); // Mengulangi mode terakhir
        reviewButton.addEventListener('click', showReviewScreen); 
        
        // Layar Review BARU
        restartFromReviewBtn.addEventListener('click', startQuiz);
        
        // Layar Kuis
        nextQuestionButton.addEventListener('click', goToNextQuestion);
        
        // Layar Flashcard
        flashcard.addEventListener('click', flipFlashcard);
        flashcardFlip.addEventListener('click', flipFlashcard);
        flashcardPrev.addEventListener('click', prevFlashcard);
        flashcardNext.addEventListener('click', nextFlashcard);
        
        // Tombol Kembali ke Menu (Global)
        backToMenuButtons.forEach(button => {
            button.addEventListener('click', showMainMenu);
        });

    </script>
</body>
</html>
